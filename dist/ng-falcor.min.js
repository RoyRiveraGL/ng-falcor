(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.ngFalcor=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=detach;function detach(model,inTemplate){var outTemplate={};var ops=[];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{var _loop=function _loop(){var prop=_step.value;var path=inTemplate[prop];ops.push(model.getValue(path).then(function(val){return outTemplate[prop]=val}))};for(var _iterator=Object.keys(inTemplate)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){_loop()}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return Promise.all(ops).then(function(){Object.defineProperty(outTemplate,"_save",{enumerable:false,value:function value(){var pathVals=[];var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=Object.keys(inTemplate)[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var prop=_step2.value;var path=inTemplate[prop];var value=outTemplate[prop];pathVals.push({path:path,value:value})}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}return model.set.apply(model,pathVals)}});return outTemplate})}},{}],2:[function(require,module,exports){"use strict";var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _falcorSyncModel=require("falcor-sync-model");var _falcorSyncModel2=_interopRequireDefault(_falcorSyncModel);var _falcor=require("falcor");var _falcor2=_interopRequireDefault(_falcor);var _falcorHttpDatasource=require("falcor-http-datasource");var _falcorHttpDatasource2=_interopRequireDefault(_falcorHttpDatasource);var _detach=require("./detach");var _detach2=_interopRequireDefault(_detach);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function create(){var origOpts=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];function factory($rootScope){var onChange=function onChange(){$rootScope.$evalAsync()};var model=undefined;var thcb=function thcb(){};var ngf=function ngf(){for(var _len=arguments.length,path=Array(_len),_key=0;_key<_len;_key++){path[_key]=arguments[_key]}path=pathify(path);return noUndef(path)?model.getValueSync(path):undefined};ngf.scope=function(scope){var isFun=typeof scope==="function";return function(){for(var _len2=arguments.length,path=Array(_len2),_key2=0;_key2<_len2;_key2++){path[_key2]=arguments[_key2]}var aScope=isFun?scope():scope;path=pathify(path);path=aScope.concat(path);return model.getValueSync(path)}};ngf.reconfigure=function(){var newOpts=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];var opts=ngf._config;var headers=newOpts.headers===undefined||newOpts.headers?Object.assign({},opts.headers,newOpts.headers):undefined;var cache=newOpts.cache||undefined;var router=undefined,timeout=undefined,source=undefined;if(newOpts.router!==undefined){router=router||undefined}else{router=opts.router}if(newOpts.timeout!==undefined){timeout=timeout||undefined}else{timeout=opts.timeout}if(newOpts.source!==undefined){source=source||undefined}else{source=opts.source}var finalOpts={headers:headers,cache:cache,router:router,timeout:timeout,source:source};ngf.configure(finalOpts)};ngf.configure=function(){var _ref=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];var source=_ref.source;var router=_ref.router;var timeout=_ref.timeout;var headers=_ref.headers;var cache=_ref.cache;ngf._config=arguments[0];delete ngf._config.cache;if(!source&&router){source=new _falcorHttpDatasource2.default(router,{timeout:timeout,headers:headers})}ngf._config._source=source;model=new _falcorSyncModel2.default({source:source,onChange:onChange,cache:cache}).batch();$rootScope.$evalAsync()};ngf.configure(origOpts);var _arr=[["get","get"],["getValue","getValue"],["set","set"],["call","callModel"],["invalidate","invalidate"],["withoutDataSource","withoutDataSource"],["getCache","getCache"]];var _loop=function _loop(){var _arr$_i=_slicedToArray(_arr[_i],2);var srcName=_arr$_i[0];var destName=_arr$_i[1];ngf[destName]=function(){var _model;var result=(_model=model)[srcName].apply(_model,arguments);if(result&&typeof result.then==="function"){result=result.then(ident)}return result}};for(var _i=0;_i<_arr.length;_i++){_loop()}ngf.twoWay=function(){for(var _len3=arguments.length,path=Array(_len3),_key3=0;_key3<_len3;_key3++){path[_key3]=arguments[_key3]}path=pathify(path);return function(value){var isSet=arguments.length>0;if(isSet){ngf.set({path:path,value:value}).then(thcb)}else{return model.getValueSync(path)}}};ngf.range=function(lo,hi){var result=[];if(lo<hi){for(var i=lo;i<=hi;i++){result.push(i)}}else if(hi<lo){for(var j=lo;j>=hi;j--){result.push(j)}}return result};ngf.detach=function(template){return(0,_detach2.default)(model,template)};ngf.reattach=function(data){return data._save()};ngf.ref=_falcor2.default.Model.ref;ngf.atom=_falcor2.default.Model.atom;ngf.error=_falcor2.default.Model.error;return ngf}factory.$inject=["$rootScope"];return factory}function ident(thing){return thing}function pathify(path){if(Array.isArray(path[0])){path=path[0]}return path}function noUndef(path){for(var i=0;i<path.length;i++){if(path[i]===undefined||path[i]===null){return false}}return true}module.exports={create:create}},{"./detach":1,falcor:51,"falcor-http-datasource":3,"falcor-sync-model":19}],3:[function(require,module,exports){"use strict";var request=require("./request");var buildQueryObject=require("./buildQueryObject");var isArray=Array.isArray;function simpleExtend(obj,obj2){var prop;for(prop in obj2){obj[prop]=obj2[prop]}return obj}function XMLHttpSource(jsongUrl,config){this._jsongUrl=jsongUrl;if(typeof config==="number"){var newConfig={timeout:config};config=newConfig}this._config=simpleExtend({timeout:15e3,headers:{}},config||{})}XMLHttpSource.prototype={constructor:XMLHttpSource,buildQueryObject:buildQueryObject,get:function httpSourceGet(pathSet){var method="GET";var queryObject=this.buildQueryObject(this._jsongUrl,method,{paths:pathSet,method:"get"});var config=simpleExtend(queryObject,this._config);var context=this;return request(method,config,context)},set:function httpSourceSet(jsongEnv){var method="POST";var queryObject=this.buildQueryObject(this._jsongUrl,method,{jsonGraph:jsongEnv,method:"set"});var config=simpleExtend(queryObject,this._config);config.headers["Content-Type"]="application/x-www-form-urlencoded";var context=this;return request(method,config,context)},call:function httpSourceCall(callPath,args,pathSuffix,paths){args=args||[];pathSuffix=pathSuffix||[];paths=paths||[];var method="POST";var queryData=[];queryData.push("method=call");queryData.push("callPath="+encodeURIComponent(JSON.stringify(callPath)));queryData.push("arguments="+encodeURIComponent(JSON.stringify(args)));queryData.push("pathSuffixes="+encodeURIComponent(JSON.stringify(pathSuffix)));queryData.push("paths="+encodeURIComponent(JSON.stringify(paths)));var queryObject=this.buildQueryObject(this._jsongUrl,method,queryData.join("&"));var config=simpleExtend(queryObject,this._config);config.headers["Content-Type"]="application/x-www-form-urlencoded";var context=this;return request(method,config,context)}};XMLHttpSource.XMLHttpSource=XMLHttpSource;XMLHttpSource["default"]=XMLHttpSource;module.exports=XMLHttpSource},{"./buildQueryObject":4,"./request":7}],4:[function(require,module,exports){"use strict";module.exports=function buildQueryObject(url,method,queryData){var qData=[];var keys;var data={url:url};var isQueryParamUrl=url.indexOf("?")!==-1;var startUrl=isQueryParamUrl?"&":"?";if(typeof queryData==="string"){qData.push(queryData)}else{keys=Object.keys(queryData);keys.forEach(function(k){var value=typeof queryData[k]==="object"?JSON.stringify(queryData[k]):queryData[k];qData.push(k+"="+encodeURIComponent(value))})}if(method==="GET"){data.url+=startUrl+qData.join("&")}else{data.data=qData.join("&")}return data}},{}],5:[function(require,module,exports){(function(global){"use strict";module.exports=function getCORSRequest(){var xhr=new global.XMLHttpRequest;if("withCredentials"in xhr){return xhr}else if(!!global.XDomainRequest){return new XDomainRequest}else{throw new Error("CORS is not supported by your browser")}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],6:[function(require,module,exports){(function(global){"use strict";module.exports=function getXMLHttpRequest(){var progId,progIds,i;if(global.XMLHttpRequest){return new global.XMLHttpRequest}else{try{progIds=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"];for(i=0;i<3;i++){try{progId=progIds[i];if(new global.ActiveXObject(progId)){break}}catch(e){}}return new global.ActiveXObject(progId)}catch(e){throw new Error("XMLHttpRequest is not supported by your browser")}}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],7:[function(require,module,exports){"use strict";var getXMLHttpRequest=require("./getXMLHttpRequest");var getCORSRequest=require("./getCORSRequest");var hasOwnProp=Object.prototype.hasOwnProperty;var noop=function(){};function Observable(){}Observable.create=function(subscribe){var o=new Observable;o.subscribe=function(onNext,onError,onCompleted){var observer;var disposable;if(typeof onNext==="function"){observer={onNext:onNext,onError:onError||noop,onCompleted:onCompleted||noop}}else{observer=onNext}disposable=subscribe(observer);if(typeof disposable==="function"){return{dispose:disposable}}else{return disposable}};return o};function request(method,options,context){return Observable.create(function requestObserver(observer){var config={method:method||"GET",crossDomain:false,async:true,headers:{},responseType:"json"};var xhr,isDone,headers,header,prop;for(prop in options){if(hasOwnProp.call(options,prop)){config[prop]=options[prop]}}if(!config.crossDomain&&!config.headers["X-Requested-With"]){config.headers["X-Requested-With"]="XMLHttpRequest"}if(context.onBeforeRequest!=null){context.onBeforeRequest(config)}try{xhr=config.crossDomain?getCORSRequest():getXMLHttpRequest()}catch(err){observer.onError(err)}try{if(config.user){xhr.open(config.method,config.url,config.async,config.user,config.password)}else{xhr.open(config.method,config.url,config.async)}xhr.timeout=config.timeout;xhr.withCredentials=config.withCredentials!==false;headers=config.headers;for(header in headers){if(hasOwnProp.call(headers,header)){xhr.setRequestHeader(header,headers[header])}}if(config.responseType){try{xhr.responseType=config.responseType}catch(e){if(config.responseType!=="json"){throw e}}}xhr.onreadystatechange=function onreadystatechange(e){if(xhr.readyState===4){if(!isDone){isDone=true;onXhrLoad(observer,xhr,e)}}};xhr.ontimeout=function ontimeout(e){if(!isDone){isDone=true;onXhrError(observer,xhr,"timeout error",e)}};xhr.send(config.data)}catch(e){observer.onError(e)}return function dispose(){if(!isDone&&xhr.readyState!==4){isDone=true;xhr.abort()}}})}function _handleXhrError(observer,textStatus,errorThrown){if(!errorThrown){errorThrown=new Error(textStatus)}observer.onError(errorThrown)}function onXhrLoad(observer,xhr,e){var responseData,responseObject,responseType;if(xhr&&observer){responseType=xhr.responseType;responseData="response"in xhr?xhr.response:xhr.responseText;var status=xhr.status===1223?204:xhr.status;if(status>=200&&status<=399){try{if(responseType!=="json"){responseData=JSON.parse(responseData||"")}if(typeof responseData==="string"){responseData=JSON.parse(responseData||"")}}catch(e){_handleXhrError(observer,"invalid json",e)}observer.onNext(responseData);observer.onCompleted();return}else if(status===401||status===403||status===407){return _handleXhrError(observer,responseData)}else if(status===410){return _handleXhrError(observer,responseData)}else if(status===408||status===504){return _handleXhrError(observer,responseData)}else{return _handleXhrError(observer,responseData||"Response code "+status)}}}function onXhrError(observer,xhr,status,e){_handleXhrError(observer,status||xhr.statusText||"request error",e)}module.exports=request},{"./getCORSRequest":5,"./getXMLHttpRequest":6}],8:[function(require,module,exports){module.exports={integers:"integers",ranges:"ranges",keys:"keys"}},{}],9:[function(require,module,exports){var TokenTypes={token:"token",dotSeparator:".",commaSeparator:",",openingBracket:"[",closingBracket:"]",openingBrace:"{",closingBrace:"}",escape:"\\",space:" ",colon:":",quote:"quote",unknown:"unknown"};module.exports=TokenTypes},{}],10:[function(require,module,exports){module.exports={indexer:{nested:"Indexers cannot be nested.",needQuotes:"unquoted indexers must be numeric.",empty:"cannot have empty indexers.",leadingDot:"Indexers cannot have leading dots.",leadingComma:"Indexers cannot have leading comma.",requiresComma:"Indexers require commas between indexer args.",routedTokens:"Only one token can be used per indexer when specifying routed tokens."},range:{precedingNaN:"ranges must be preceded by numbers.",suceedingNaN:"ranges must be suceeded by numbers."},routed:{invalid:"Invalid routed token.  only integers|ranges|keys are supported."},quote:{empty:"cannot have empty quoted keys.",illegalEscape:"Invalid escape character.  Only quotes are escapable."},unexpectedToken:"Unexpected token.",invalidIdentifier:"Invalid Identifier.",invalidPath:"Please provide a valid path.",throwError:function(err,tokenizer,token){if(token){throw err+" -- "+tokenizer.parseString+" with next token: "+token}throw err+" -- "+tokenizer.parseString}}},{}],11:[function(require,module,exports){var Tokenizer=require("./tokenizer");var head=require("./parse-tree/head");var RoutedTokens=require("./RoutedTokens");var parser=function parser(string,extendedRules){return head(new Tokenizer(string,extendedRules))};module.exports=parser;parser.fromPathsOrPathValues=function(paths,ext){if(!paths){return[]}var out=[];for(var i=0,len=paths.length;i<len;i++){if(typeof paths[i]==="string"){out[i]=parser(paths[i],ext)}else if(typeof paths[i].path==="string"){out[i]={path:parser(paths[i].path,ext),value:paths[i].value}}else{out[i]=paths[i]}}return out};parser.fromPath=function(path,ext){if(!path){return[]}if(typeof path==="string"){return parser(path,ext)}return path};parser.RoutedTokens=RoutedTokens},{"./RoutedTokens":8,"./parse-tree/head":12,"./tokenizer":17}],12:[function(require,module,exports){var TokenTypes=require("./../TokenTypes");var E=require("./../exceptions");var indexer=require("./indexer");module.exports=function head(tokenizer){var token=tokenizer.next();var state={};var out=[];while(!token.done){switch(token.type){case TokenTypes.token:var first=+token.token[0];if(!isNaN(first)){E.throwError(E.invalidIdentifier,tokenizer)}out[out.length]=token.token;break;case TokenTypes.dotSeparator:if(out.length===0){E.throwError(E.unexpectedToken,tokenizer)}break;case TokenTypes.space:break;case TokenTypes.openingBracket:indexer(tokenizer,token,state,out);break;default:E.throwError(E.unexpectedToken,tokenizer);break}token=tokenizer.next()}if(out.length===0){E.throwError(E.invalidPath,tokenizer)}return out}},{"./../TokenTypes":9,"./../exceptions":10,"./indexer":13}],13:[function(require,module,exports){var TokenTypes=require("./../TokenTypes");var E=require("./../exceptions");var idxE=E.indexer;var range=require("./range");var quote=require("./quote");var routed=require("./routed");module.exports=function indexer(tokenizer,openingToken,state,out){var token=tokenizer.next();var done=false;var allowedMaxLength=1;var routedIndexer=false;state.indexer=[];while(!token.done){switch(token.type){case TokenTypes.token:case TokenTypes.quote:if(state.indexer.length===allowedMaxLength){E.throwError(idxE.requiresComma,tokenizer)}break}switch(token.type){case TokenTypes.openingBrace:routedIndexer=true;routed(tokenizer,token,state,out);break;case TokenTypes.token:var t=+token.token;if(isNaN(t)){E.throwError(idxE.needQuotes,tokenizer)}state.indexer[state.indexer.length]=t;break;case TokenTypes.dotSeparator:if(!state.indexer.length){E.throwError(idxE.leadingDot,tokenizer)}range(tokenizer,token,state,out);break;case TokenTypes.space:break;case TokenTypes.closingBracket:done=true;break;case TokenTypes.quote:quote(tokenizer,token,state,out);break;case TokenTypes.openingBracket:E.throwError(idxE.nested,tokenizer);break;case TokenTypes.commaSeparator:++allowedMaxLength;break;default:E.throwError(E.unexpectedToken,tokenizer);break}if(done){break}token=tokenizer.next()}if(state.indexer.length===0){E.throwError(idxE.empty,tokenizer)}if(state.indexer.length>1&&routedIndexer){E.throwError(idxE.routedTokens,tokenizer)}if(state.indexer.length===1){state.indexer=state.indexer[0]}out[out.length]=state.indexer;state.indexer=undefined}},{"./../TokenTypes":9,"./../exceptions":10,"./quote":14,"./range":15,"./routed":16}],14:[function(require,module,exports){var TokenTypes=require("./../TokenTypes");var E=require("./../exceptions");var quoteE=E.quote;module.exports=function quote(tokenizer,openingToken,state,out){var token=tokenizer.next();var innerToken="";var openingQuote=openingToken.token;var escaping=false;var done=false;while(!token.done){switch(token.type){case TokenTypes.token:case TokenTypes.space:case TokenTypes.dotSeparator:case TokenTypes.commaSeparator:case TokenTypes.openingBracket:case TokenTypes.closingBracket:case TokenTypes.openingBrace:case TokenTypes.closingBrace:if(escaping){E.throwError(quoteE.illegalEscape,tokenizer)}innerToken+=token.token;break;case TokenTypes.quote:if(escaping){innerToken+=token.token;escaping=false}else if(token.token!==openingQuote){innerToken+=token.token}else{done=true}break;case TokenTypes.escape:escaping=true;break;default:E.throwError(E.unexpectedToken,tokenizer)}if(done){break}token=tokenizer.next()}if(innerToken.length===0){E.throwError(quoteE.empty,tokenizer)}state.indexer[state.indexer.length]=innerToken}},{"./../TokenTypes":9,"./../exceptions":10}],15:[function(require,module,exports){var Tokenizer=require("./../tokenizer");var TokenTypes=require("./../TokenTypes");var E=require("./../exceptions");module.exports=function range(tokenizer,openingToken,state,out){var token=tokenizer.peek();var dotCount=1;var done=false;var inclusive=true;var idx=state.indexer.length-1;var from=Tokenizer.toNumber(state.indexer[idx]);var to;if(isNaN(from)){E.throwError(E.range.precedingNaN,tokenizer)}while(!done&&!token.done){switch(token.type){case TokenTypes.dotSeparator:if(dotCount===3){E.throwError(E.unexpectedToken,tokenizer)}++dotCount;if(dotCount===3){inclusive=false}break;case TokenTypes.token:to=Tokenizer.toNumber(tokenizer.next().token);if(isNaN(to)){E.throwError(E.range.suceedingNaN,tokenizer)}done=true;break;default:done=true;break}if(!done){tokenizer.next();token=tokenizer.peek()}else{break}}state.indexer[idx]={from:from,to:inclusive?to:to-1}}},{"./../TokenTypes":9,"./../exceptions":10,"./../tokenizer":17}],16:[function(require,module,exports){var TokenTypes=require("./../TokenTypes");var RoutedTokens=require("./../RoutedTokens");var E=require("./../exceptions");var routedE=E.routed;module.exports=function routed(tokenizer,openingToken,state,out){var routeToken=tokenizer.next();var named=false;var name="";switch(routeToken.token){case RoutedTokens.integers:case RoutedTokens.ranges:case RoutedTokens.keys:break;default:E.throwError(routedE.invalid,tokenizer);break}var next=tokenizer.next();if(next.type===TokenTypes.colon){named=true;next=tokenizer.next();if(next.type!==TokenTypes.token){E.throwError(routedE.invalid,tokenizer)}name=next.token;next=tokenizer.next()}if(next.type===TokenTypes.closingBrace){var outputToken={type:routeToken.token,named:named,name:name};state.indexer[state.indexer.length]=outputToken}else{E.throwError(routedE.invalid,tokenizer)}}},{"./../RoutedTokens":8,"./../TokenTypes":9,"./../exceptions":10}],17:[function(require,module,exports){var TokenTypes=require("./../TokenTypes");var DOT_SEPARATOR=".";var COMMA_SEPARATOR=",";var OPENING_BRACKET="[";var CLOSING_BRACKET="]";var OPENING_BRACE="{";var CLOSING_BRACE="}";var COLON=":";var ESCAPE="\\";var DOUBLE_OUOTES='"';var SINGE_OUOTES="'";var SPACE=" ";var SPECIAL_CHARACTERS="\\'\"[]., ";var EXT_SPECIAL_CHARACTERS="\\{}'\"[]., :";var Tokenizer=module.exports=function(string,ext){this._string=string;this._idx=-1;this._extended=ext;this.parseString=""};Tokenizer.prototype={next:function(){var nextToken=this._nextToken?this._nextToken:getNext(this._string,this._idx,this._extended);this._idx=nextToken.idx;this._nextToken=false;this.parseString+=nextToken.token.token;return nextToken.token},peek:function(){var nextToken=this._nextToken?this._nextToken:getNext(this._string,this._idx,this._extended);this._nextToken=nextToken;return nextToken.token}};Tokenizer.toNumber=function toNumber(x){if(!isNaN(+x)){return+x}return NaN};function toOutput(token,type,done){return{token:token,done:done,type:type}}function getNext(string,idx,ext){var output=false;var token="";var specialChars=ext?EXT_SPECIAL_CHARACTERS:SPECIAL_CHARACTERS;var done;do{done=idx+1>=string.length;if(done){break}var character=string[idx+1];if(character!==undefined&&specialChars.indexOf(character)===-1){token+=character;++idx;continue}else if(token.length){break}++idx;var type;switch(character){case DOT_SEPARATOR:type=TokenTypes.dotSeparator;break;case COMMA_SEPARATOR:type=TokenTypes.commaSeparator;break;case OPENING_BRACKET:type=TokenTypes.openingBracket;break;case CLOSING_BRACKET:type=TokenTypes.closingBracket;break;case OPENING_BRACE:type=TokenTypes.openingBrace;break;case CLOSING_BRACE:type=TokenTypes.closingBrace;break;case SPACE:type=TokenTypes.space;break;case DOUBLE_OUOTES:case SINGE_OUOTES:type=TokenTypes.quote;break;case ESCAPE:type=TokenTypes.escape;break;case COLON:type=TokenTypes.colon;break;default:type=TokenTypes.unknown;break}output=toOutput(character,type,false);break}while(!done);if(!output&&token.length){output=toOutput(token,TokenTypes.token,false)}if(!output){output={done:true}}return{token:output,idx:idx}}},{"./../TokenTypes":9}],18:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=extract;exports.extractFromCache=extractFromCache;function extract(model,path){return extractFromCache(model._root.cache,path)}function extractFromCache(obj,path){var idx=arguments.length<=2||arguments[2]===undefined?0:arguments[2];var root=arguments.length<=3||arguments[3]===undefined?obj:arguments[3];var isRef=obj&&obj.$type==="ref";if(isRef){var newPath=obj.value.concat(path.slice(idx));return extractFromCache(root,newPath)}else if(path.length-idx===0){return obj&&obj.$type?obj.value:obj}else if(obj===null||obj===undefined){return obj}else{var step=path[idx];return extractFromCache(obj[step],path,idx+1,root)}}},{}],19:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _falcor=require("falcor");var _extract=require("./extract");var _extract2=_interopRequireDefault(_extract);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var noop=function noop(){};var SyncModel=function(_Model){_inherits(SyncModel,_Model);function SyncModel(){_classCallCheck(this,SyncModel);return _possibleConstructorReturn(this,Object.getPrototypeOf(SyncModel).apply(this,arguments))}_createClass(SyncModel,[{key:"getValueSync",value:function getValueSync(path){this.getValue(path).then(noop);return(0,_extract2.default)(this,path)}},{key:"_clone",value:function _clone(opts){var clone=new SyncModel(this);for(var key in opts){var value=opts[key];if(value==="delete"){delete clone[key]}else{clone[key]=value}}clone.setCache=void 0;return clone}}]);return SyncModel}(_falcor.Model);module.exports=SyncModel},{"./extract":18,falcor:51}],20:[function(require,module,exports){var ModelRoot=require("./ModelRoot");var ModelDataSourceAdapter=require("./ModelDataSourceAdapter");var RequestQueue=require("./request/RequestQueueV2");var ModelResponse=require("./response/ModelResponse");var CallResponse=require("./response/CallResponse");var InvalidateResponse=require("./response/InvalidateResponse");var ASAPScheduler=require("./schedulers/ASAPScheduler");var TimeoutScheduler=require("./schedulers/TimeoutScheduler");var ImmediateScheduler=require("./schedulers/ImmediateScheduler");var arrayClone=require("./support/array-clone");var arraySlice=require("./support/array-slice");var collectLru=require("./lru/collect");var pathSyntax=require("falcor-path-syntax");var getSize=require("./support/getSize");var isObject=require("./support/isObject");var isPrimitive=require("./support/isPrimitive");var isJSONEnvelope=require("./support/isJSONEnvelope");var isJSONGraphEnvelope=require("./support/isJSONGraphEnvelope");var setCache=require("./set/setPathMaps");var setJSONGraphs=require("./set/setJSONGraphs");var jsong=require("falcor-json-graph");var ID=0;var validateInput=require("./support/validateInput");var noOp=function(){};var getCache=require("./get/getCache");var get=require("./get");var GET_VALID_INPUT=require("./response/get/validInput");module.exports=Model;Model.ref=jsong.ref;Model.atom=jsong.atom;Model.error=jsong.error;Model.pathValue=jsong.pathValue;function Model(o){var options=o||{};this._root=options._root||new ModelRoot(options);this._path=options.path||options._path||[];this._scheduler=options.scheduler||options._scheduler||new ImmediateScheduler;this._source=options.source||options._source;this._request=options.request||options._request||new RequestQueue(this,this._scheduler);this._ID=ID++;if(typeof options.maxSize==="number"){this._maxSize=options.maxSize}else{this._maxSize=options._maxSize||Model.prototype._maxSize}if(typeof options.collectRatio==="number"){this._collectRatio=options.collectRatio}else{this._collectRatio=options._collectRatio||Model.prototype._collectRatio}if(options.boxed||options.hasOwnProperty("_boxed")){this._boxed=options.boxed||options._boxed}if(options.materialized||options.hasOwnProperty("_materialized")){this._materialized=options.materialized||options._materialized}if(typeof options.treatErrorsAsValues==="boolean"){this._treatErrorsAsValues=options.treatErrorsAsValues}else if(options.hasOwnProperty("_treatErrorsAsValues")){this._treatErrorsAsValues=options._treatErrorsAsValues}this._allowFromWhenceYouCame=options.allowFromWhenceYouCame||options._allowFromWhenceYouCame||false;if(options.cache){this.setCache(options.cache)}}Model.prototype.constructor=Model;Model.prototype._materialized=false;Model.prototype._boxed=false;Model.prototype._progressive=false;Model.prototype._treatErrorsAsValues=false;Model.prototype._maxSize=Math.pow(2,53)-1;Model.prototype._collectRatio=.75;Model.prototype.get=require("./response/get");Model.prototype._getWithPaths=require("./response/get/getWithPaths");Model.prototype.set=require("./response/set");Model.prototype.preload=function preload(){var out=validateInput(arguments,GET_VALID_INPUT,"preload");if(out!==true){return new ModelResponse(function(o){o.onError(out)})}var args=Array.prototype.slice.call(arguments);var self=this;return new ModelResponse(function(obs){return self.get.apply(self,args).subscribe(function(){},function(err){obs.onError(err)},function(){obs.onCompleted()})})};Model.prototype.call=function call(){var args;var argsIdx=-1;var argsLen=arguments.length;args=new Array(argsLen);while(++argsIdx<argsLen){var arg=arguments[argsIdx];args[argsIdx]=arg;var argType=typeof arg;if(argsIdx>1&&!Array.isArray(arg)||argsIdx===0&&!Array.isArray(arg)&&argType!=="string"||argsIdx===1&&!Array.isArray(arg)&&!isPrimitive(arg)){return new ModelResponse(function(o){o.onError(new Error("Invalid argument"))})}}return new CallResponse(this,args[0],args[1],args[2],args[3])};Model.prototype.invalidate=function invalidate(){var args;var argsIdx=-1;var argsLen=arguments.length;args=[];while(++argsIdx<argsLen){args[argsIdx]=pathSyntax.fromPath(arguments[argsIdx]);if(!Array.isArray(args[argsIdx])){throw new Error("Invalid argument")}}new InvalidateResponse(this,args).subscribe(noOp,function(e){throw e})};Model.prototype.deref=require("./deref");Model.prototype._hasValidParentReference=require("./deref/hasValidParentReference");Model.prototype.getValue=require("./get/getValue");Model.prototype.setValue=require("./set/setValue");Model.prototype._getValueSync=require("./get/sync");Model.prototype._setValueSync=require("./set/sync");Model.prototype._derefSync=require("./deref/sync");Model.prototype.setCache=function modelSetCache(cacheOrJSONGraphEnvelope){var cache=this._root.cache;if(cacheOrJSONGraphEnvelope!==cache){var modelRoot=this._root;var boundPath=this._path;this._path=[];this._root.cache={};if(typeof cache!=="undefined"){collectLru(modelRoot,modelRoot.expired,getSize(cache),0)}var out;if(isJSONGraphEnvelope(cacheOrJSONGraphEnvelope)){out=setJSONGraphs(this,[cacheOrJSONGraphEnvelope])[0]}else if(isJSONEnvelope(cacheOrJSONGraphEnvelope)){out=setCache(this,[cacheOrJSONGraphEnvelope])[0]}else if(isObject(cacheOrJSONGraphEnvelope)){out=setCache(this,[{json:cacheOrJSONGraphEnvelope
}])[0]}if(out){get.getWithPathsAsPathMap(this,out,[])}this._path=boundPath}else if(typeof cache==="undefined"){this._root.cache={}}return this};Model.prototype.getCache=function _getCache(){var paths=arraySlice(arguments);if(paths.length===0){return getCache(this._root.cache)}var result=[{}];var path=this._path;get.getWithPathsAsJSONGraph(this,paths,result);this._path=path;return result[0].jsonGraph};Model.prototype.getVersion=function getVersion(pathArg){var path=pathArg&&pathSyntax.fromPath(pathArg)||[];if(Array.isArray(path)===false){throw new Error("Model#getVersion must be called with an Array path.")}if(this._path.length){path=this._path.concat(path)}return this._getVersion(this,path)};Model.prototype._syncCheck=function syncCheck(name){if(Boolean(this._source)&&this._root.syncRefCount<=0&&this._root.unsafeMode===false){throw new Error("Model#"+name+" may only be called within the context of a request selector.")}return true};Model.prototype._clone=function cloneModel(opts){var clone=new Model(this);for(var key in opts){var value=opts[key];if(value==="delete"){delete clone[key]}else{clone[key]=value}}clone.setCache=void 0;return clone};Model.prototype.batch=function batch(schedulerOrDelayArg){var schedulerOrDelay=schedulerOrDelayArg;if(typeof schedulerOrDelay==="number"){schedulerOrDelay=new TimeoutScheduler(Math.round(Math.abs(schedulerOrDelay)))}else if(!schedulerOrDelay||!schedulerOrDelay.schedule){schedulerOrDelay=new ASAPScheduler}var clone=this._clone();clone._request=new RequestQueue(clone,schedulerOrDelay);return clone};Model.prototype.unbatch=function unbatch(){var clone=this._clone();clone._request=new RequestQueue(clone,new ImmediateScheduler);return clone};Model.prototype.treatErrorsAsValues=function treatErrorsAsValues(){return this._clone({_treatErrorsAsValues:true})};Model.prototype.asDataSource=function asDataSource(){return new ModelDataSourceAdapter(this)};Model.prototype._materialize=function materialize(){return this._clone({_materialized:true})};Model.prototype._dematerialize=function dematerialize(){return this._clone({_materialized:"delete"})};Model.prototype.boxValues=function boxValues(){return this._clone({_boxed:true})};Model.prototype.unboxValues=function unboxValues(){return this._clone({_boxed:"delete"})};Model.prototype.withoutDataSource=function withoutDataSource(){return this._clone({_source:"delete"})};Model.prototype.toJSON=function toJSON(){return{$type:"ref",value:this._path}};Model.prototype.getPath=function getPath(){return arrayClone(this._path)};Model.prototype._fromWhenceYouCame=function fromWhenceYouCame(allow){return this._clone({_allowFromWhenceYouCame:allow===undefined?true:allow})};Model.prototype._getBoundValue=require("./get/getBoundValue");Model.prototype._getVersion=require("./get/getVersion");Model.prototype._getValueSync=require("./get/getValueSync");Model.prototype._getPathValuesAsPathMap=get.getWithPathsAsPathMap;Model.prototype._getPathValuesAsJSONG=get.getWithPathsAsJSONGraph;Model.prototype._setPathValues=require("./set/setPathValues");Model.prototype._setPathMaps=require("./set/setPathMaps");Model.prototype._setJSONGs=require("./set/setJSONGraphs");Model.prototype._setCache=require("./set/setPathMaps");Model.prototype._invalidatePathValues=require("./invalidate/invalidatePathSets");Model.prototype._invalidatePathMaps=require("./invalidate/invalidatePathMaps")},{"./ModelDataSourceAdapter":21,"./ModelRoot":22,"./deref":24,"./deref/hasValidParentReference":23,"./deref/sync":25,"./get":40,"./get/getBoundValue":34,"./get/getCache":35,"./get/getValue":37,"./get/getValueSync":38,"./get/getVersion":39,"./get/sync":45,"./invalidate/invalidatePathMaps":54,"./invalidate/invalidatePathSets":55,"./lru/collect":56,"./request/RequestQueueV2":60,"./response/CallResponse":66,"./response/InvalidateResponse":67,"./response/ModelResponse":68,"./response/get":73,"./response/get/getWithPaths":72,"./response/get/validInput":74,"./response/set":76,"./schedulers/ASAPScheduler":80,"./schedulers/ImmediateScheduler":81,"./schedulers/TimeoutScheduler":82,"./set/setJSONGraphs":83,"./set/setPathMaps":84,"./set/setPathValues":85,"./set/setValue":86,"./set/sync":87,"./support/array-clone":88,"./support/array-slice":91,"./support/getSize":96,"./support/isJSONEnvelope":106,"./support/isJSONGraphEnvelope":107,"./support/isObject":108,"./support/isPrimitive":110,"./support/validateInput":124,"falcor-json-graph":133,"falcor-path-syntax":11}],21:[function(require,module,exports){function ModelDataSourceAdapter(model){this._model=model._materialize().boxValues().treatErrorsAsValues()}ModelDataSourceAdapter.prototype.get=function get(pathSets){return this._model.get.apply(this._model,pathSets)._toJSONG()};ModelDataSourceAdapter.prototype.set=function set(jsongResponse){return this._model.set(jsongResponse)._toJSONG()};ModelDataSourceAdapter.prototype.call=function call(path,args,suffixes,paths){var params=[path,args,suffixes].concat(paths);return this._model.call.apply(this._model,params)._toJSONG()};module.exports=ModelDataSourceAdapter},{}],22:[function(require,module,exports){var isFunction=require("./support/isFunction");var hasOwn=require("./support/hasOwn");var ImmediateScheduler=require("./schedulers/ImmediateScheduler");function ModelRoot(o){var options=o||{};this.syncRefCount=0;this.expired=options.expired||[];this.unsafeMode=options.unsafeMode||false;this.collectionScheduler=options.collectionScheduler||new ImmediateScheduler;this.cache={};if(isFunction(options.comparator)){this.comparator=options.comparator}if(isFunction(options.errorSelector)){this.errorSelector=options.errorSelector}if(isFunction(options.onChange)){this.onChange=options.onChange}}ModelRoot.prototype.errorSelector=function errorSelector(x,y){return y};ModelRoot.prototype.comparator=function comparator(cacheNode,messageNode){if(hasOwn(cacheNode,"value")&&hasOwn(messageNode,"value")){return cacheNode.value===messageNode.value&&cacheNode.$type===messageNode.$type&&cacheNode.$expires===messageNode.$expires}return cacheNode===messageNode};module.exports=ModelRoot},{"./schedulers/ImmediateScheduler":81,"./support/hasOwn":99,"./support/isFunction":104}],23:[function(require,module,exports){module.exports=function fromWhenceYeCame(){var reference=this._referenceContainer;if(!this._allowFromWhenceYouCame){return true}if(reference===true){return true}if(reference===false){return false}if(reference&&reference.ツparent===undefined){return false}if(reference&&reference.ツinvalidated){return false}return true}},{}],24:[function(require,module,exports){var InvalidDerefInputError=require("./../errors/InvalidDerefInputError");var getCachePosition=require("./../get/getCachePosition");var CONTAINER_DOES_NOT_EXIST="e";var $ref=require("./../types/ref");module.exports=function deref(boundJSONArg){var absolutePath=boundJSONArg&&boundJSONArg.$__path;var refPath=boundJSONArg&&boundJSONArg.$__refPath;var toReference=boundJSONArg&&boundJSONArg.$__toReference;var referenceContainer;if(absolutePath){var validContainer=CONTAINER_DOES_NOT_EXIST;if(toReference){validContainer=false;referenceContainer=getCachePosition(this,toReference);if(refPath&&referenceContainer&&referenceContainer.$type===$ref){var containerPath=referenceContainer.value;var i=0;var len=refPath.length;validContainer=true;for(;validContainer&&i<len;++i){if(containerPath[i]!==refPath[i]){validContainer=false}}}}if(!validContainer){referenceContainer=false}else if(validContainer===CONTAINER_DOES_NOT_EXIST){referenceContainer=true}return this._clone({_path:absolutePath,_referenceContainer:referenceContainer})}throw new InvalidDerefInputError}},{"./../errors/InvalidDerefInputError":27,"./../get/getCachePosition":36,"./../types/ref":128}],25:[function(require,module,exports){var pathSyntax=require("falcor-path-syntax");var getBoundValue=require("./../get/getBoundValue");var InvalidModelError=require("./../errors/InvalidModelError");module.exports=function derefSync(boundPathArg){var boundPath=pathSyntax.fromPath(boundPathArg);if(!Array.isArray(boundPath)){throw new Error("Model#derefSync must be called with an Array path.")}var boundValue=getBoundValue(this,this._path.concat(boundPath),false);var path=boundValue.path;var node=boundValue.value;var found=boundValue.found;if(!found||node===undefined){return undefined}if(node.$type){throw new InvalidModelError}return this._clone({_path:path})}},{"./../errors/InvalidModelError":28,"./../get/getBoundValue":34,"falcor-path-syntax":11}],26:[function(require,module,exports){function BoundJSONGraphModelError(){this.message=BoundJSONGraphModelError.message;this.stack=(new Error).stack}BoundJSONGraphModelError.prototype=new Error;BoundJSONGraphModelError.prototype.name="BoundJSONGraphModelError";BoundJSONGraphModelError.message="It is not legal to use the JSON Graph "+"format from a bound Model. JSON Graph format"+" can only be used from a root model.";module.exports=BoundJSONGraphModelError},{}],27:[function(require,module,exports){var NAME="InvalidDerefInputError";var MESSAGE="Deref can only be used with a non-primitive object from get, set, or call.";function InvalidDerefInputError(){this.message=MESSAGE;this.stack=(new Error).stack}InvalidDerefInputError.prototype=new Error;InvalidDerefInputError.prototype.name=NAME;InvalidDerefInputError.name=NAME;InvalidDerefInputError.message=MESSAGE;module.exports=InvalidDerefInputError},{}],28:[function(require,module,exports){var NAME="InvalidModelError";var MESSAGE="The boundPath of the model is not valid since a value or error was found before the path end.";function InvalidModelError(boundPath,shortedPath){this.message=MESSAGE;this.stack=(new Error).stack;this.boundPath=boundPath;this.shortedPath=shortedPath}InvalidModelError.prototype=new Error;InvalidModelError.prototype.name=NAME;InvalidModelError.message=MESSAGE;module.exports=InvalidModelError},{}],29:[function(require,module,exports){var NAME="InvalidSourceError";function InvalidSourceError(error){this.message="An exception was thrown when making a request.";this.stack=(new Error).stack;this.innerError=error}InvalidSourceError.prototype=new Error;InvalidSourceError.prototype.name=NAME;InvalidSourceError.is=function(e){return e&&e.name===NAME};module.exports=InvalidSourceError},{}],30:[function(require,module,exports){var NAME="MaxRetryExceededError";function MaxRetryExceededError(){this.message="The allowed number of retries have been exceeded.";this.stack=(new Error).stack}MaxRetryExceededError.prototype=new Error;MaxRetryExceededError.prototype.name=NAME;MaxRetryExceededError.is=function(e){return e&&e.name===NAME};module.exports=MaxRetryExceededError},{}],31:[function(require,module,exports){var NAME="NullInPathError";var MESSAGE="`null` is not allowed in branch key positions.";function NullInPathError(){this.message=MESSAGE;this.stack=(new Error).stack}NullInPathError.prototype=new Error;NullInPathError.prototype.name=NAME;NullInPathError.message=MESSAGE;module.exports=NullInPathError},{}],32:[function(require,module,exports){var createHardlink=require("./../support/createHardlink");var onValue=require("./../get/onValue");var isExpired=require("./../get/util/isExpired");var $ref=require("./../types/ref");var promote=require("./../lru/promote");function followReference(model,root,nodeArg,referenceContainerArg,referenceArg,seed,isJSONG){var node=nodeArg;var reference=referenceArg;var referenceContainer=referenceContainerArg;var depth=0;var k,next;while(true){if(depth===0&&referenceContainer.ツcontext){depth=reference.length;next=referenceContainer.ツcontext}else{k=reference[depth++];next=node[k]}if(next){var type=next.$type;var value=type&&next.value||next;if(depth<reference.length){if(type){node=next;break}node=next;continue}else{node=next;if(type&&isExpired(next)){break}if(!referenceContainer.ツcontext){createHardlink(referenceContainer,next)}if(type===$ref){if(isJSONG){onValue(model,next,seed,null,null,null,null,reference,reference.length,isJSONG)}else{promote(model._root,next)}depth=0;reference=value;referenceContainer=next;node=root;continue}break}}else{node=void 0}break}if(depth<reference.length&&node!==void 0){var ref=[];for(var i=0;i<depth;i++){ref[i]=reference[i]}reference=ref}return[node,reference,referenceContainer]}module.exports=followReference},{"./../get/onValue":43,"./../get/util/isExpired":47,"./../lru/promote":57,"./../support/createHardlink":93,"./../types/ref":128}],33:[function(require,module,exports){var getCachePosition=require("./../get/getCachePosition");var InvalidModelError=require("./../errors/InvalidModelError");var BoundJSONGraphModelError=require("./../errors/BoundJSONGraphModelError");module.exports=function get(walk,isJSONG){return function innerGet(model,paths,seed){var valueNode=seed[0];var results={values:seed,optimizedPaths:[]};var cache=model._root.cache;var boundPath=model._path;var currentCachePosition=cache;var optimizedPath,optimizedLength=boundPath.length;var i,len;var requestedPath=[];var derefInfo=[];var referenceContainer;if(optimizedLength){if(isJSONG){return{criticalError:new BoundJSONGraphModelError}}currentCachePosition=getCachePosition(model,boundPath);if(currentCachePosition.$type){return{criticalError:new InvalidModelError(boundPath,boundPath)}}optimizedPath=[];for(i=0;i<optimizedLength;++i){optimizedPath[i]=boundPath[i]}referenceContainer=model._referenceContainer}else{optimizedPath=[];optimizedLength=0}for(i=0,len=paths.length;i<len;i++){walk(model,cache,currentCachePosition,paths[i],0,valueNode,results,derefInfo,requestedPath,optimizedPath,optimizedLength,isJSONG,false,referenceContainer)}return results}}},{"./../errors/BoundJSONGraphModelError":26,"./../errors/InvalidModelError":28,"./../get/getCachePosition":36}],34:[function(require,module,exports){var getValueSync=require("./../get/getValueSync");var InvalidModelError=require("./../errors/InvalidModelError");module.exports=function getBoundValue(model,pathArg,materialized){var path=pathArg;var boundPath=pathArg;var boxed,treatErrorsAsValues,value,shorted,found;boxed=model._boxed;materialized=model._materialized;treatErrorsAsValues=model._treatErrorsAsValues;model._boxed=true;model._materialized=materialized===undefined||materialized;model._treatErrorsAsValues=true;value=getValueSync(model,path.concat(null),true);model._boxed=boxed;model._materialized=materialized;model._treatErrorsAsValues=treatErrorsAsValues;path=value.optimizedPath;shorted=value.shorted;found=value.found;value=value.value;while(path.length&&path[path.length-1]===null){path.pop()}if(found&&shorted){throw new InvalidModelError(boundPath,path)}return{path:path,value:value,shorted:shorted,found:found}}},{"./../errors/InvalidModelError":28,"./../get/getValueSync":38}],35:[function(require,module,exports){var isInternalKey=require("./../support/isInternalKey");module.exports=function getCache(cache){var out={};_copyCache(cache,out);return out};function cloneBoxedValue(boxedValue){var clonedValue={};var keys=Object.keys(boxedValue);var key;var i;var l;for(i=0,l=keys.length;i<l;i++){key=keys[i];if(!isInternalKey(key)){clonedValue[key]=boxedValue[key]}}return clonedValue}function _copyCache(node,out,fromKey){Object.keys(node).filter(function(k){return!isInternalKey(k)&&node[k]!==undefined}).forEach(function(key){var cacheNext=node[key];var outNext=out[key];if(!outNext){outNext=out[key]={}}if(cacheNext.$type){var isObject=cacheNext.value&&typeof cacheNext.value==="object";var isUserCreatedcacheNext=!cacheNext.ツmodelCreated;var value;if(isObject||isUserCreatedcacheNext){value=cloneBoxedValue(cacheNext)}else{value=cacheNext.value}out[key]=value;return}_copyCache(cacheNext,outNext,key)})}},{"./../support/isInternalKey":105}],36:[function(require,module,exports){module.exports=function getCachePosition(model,path){var currentCachePosition=model._root.cache;var depth=-1;var maxDepth=path.length;while(++depth<maxDepth&&currentCachePosition&&!currentCachePosition.$type){currentCachePosition=currentCachePosition[path[depth]]}return currentCachePosition}},{}],37:[function(require,module,exports){var ModelResponse=require("./../response/ModelResponse");var pathSyntax=require("falcor-path-syntax");module.exports=function getValue(path){var parsedPath=pathSyntax.fromPath(path);var pathIdx=0;var pathLen=parsedPath.length;while(++pathIdx<pathLen){if(typeof parsedPath[pathIdx]==="object"){return new ModelResponse(function(o){o.onError(new Error("Paths must be simple paths"))})}}var self=this;return new ModelResponse(function(obs){return self.get(parsedPath).subscribe(function(data){var curr=data.json;var depth=-1;var length=parsedPath.length;while(curr&&++depth<length){curr=curr[parsedPath[depth]]}obs.onNext(curr)},function(err){obs.onError(err)},function(){obs.onCompleted()})})}},{"./../response/ModelResponse":68,"falcor-path-syntax":11}],38:[function(require,module,exports){var followReference=require("./../get/followReference");var clone=require("./../get/util/clone");var isExpired=require("./../get/util/isExpired");var promote=require("./../lru/promote");var $ref=require("./../types/ref");var $atom=require("./../types/atom");var $error=require("./../types/error");module.exports=function getValueSync(model,simplePath,noClone){var root=model._root.cache;var len=simplePath.length;var optimizedPath=[];var shorted=false,shouldShort=false;var depth=0;var key,i,next=root,curr=root,out=root,type,ref,refNode;var found=true;var expired=false;while(next&&depth<len){key=simplePath[depth++];if(key!==null){next=curr[key];optimizedPath[optimizedPath.length]=key}if(!next){out=undefined;shorted=true;found=false;break}type=next.$type;if(type===$atom&&next.value===undefined){out=undefined;found=false;shorted=depth<len;break}if(depth<len){if(type===$ref){if(isExpired(next)){expired=true;out=undefined;break}ref=followReference(model,root,root,next,next.value);refNode=ref[0];if(!refNode){out=void 0;next=void 0;found=false;break}type=refNode.$type;next=refNode;optimizedPath=ref[1].slice(0)}if(type){break}}else{out=next}curr=next}if(depth<len&&!expired){for(i=depth;i<len;++i){if(simplePath[depth]!==null){shouldShort=true;break}}if(shouldShort){shorted=true;out=void 0}else{out=next}for(i=depth;i<len;++i){if(simplePath[i]!==null){optimizedPath[optimizedPath.length]=simplePath[i]}}}if(out&&type){if(isExpired(out)){out=void 0}else{promote(model._root,out)}}if(out&&type===$error&&!model._treatErrorsAsValues){throw{path:depth===len?simplePath:simplePath.slice(0,depth),value:out.value}}else if(out&&model._boxed){out=Boolean(type)&&!noClone?clone(out):out}else if(!out&&model._materialized){out={$type:$atom}}else if(out){out=out.value}return{value:out,shorted:shorted,optimizedPath:optimizedPath,found:found}}},{"./../get/followReference":32,"./../get/util/clone":46,"./../get/util/isExpired":47,"./../lru/promote":57,"./../types/atom":126,"./../types/error":127,"./../types/ref":128}],39:[function(require,module,exports){module.exports=function _getVersion(model,path){var gen=model._getValueSync({_boxed:true,_root:model._root,_treatErrorsAsValues:model._treatErrorsAsValues},path,true).value;var version=gen&&gen.ツversion;return version==null?-1:version}},{}],40:[function(require,module,exports){var get=require("./get");var walkPath=require("./walkPath");var getWithPathsAsPathMap=get(walkPath,false);var getWithPathsAsJSONGraph=get(walkPath,true);module.exports={getValueSync:require("./../get/getValueSync"),getBoundValue:require("./../get/getBoundValue"),getWithPathsAsPathMap:getWithPathsAsPathMap,getWithPathsAsJSONGraph:getWithPathsAsJSONGraph}},{"./../get/getBoundValue":34,"./../get/getValueSync":38,"./get":33,"./walkPath":50}],41:[function(require,module,exports){var promote=require("./../lru/promote");var clone=require("./../get/util/clone");module.exports=function onError(model,node,depth,requestedPath,outerResults){var value=node.value;if(!outerResults.errors){outerResults.errors=[]}if(model._boxed){value=clone(node)}outerResults.errors.push({path:requestedPath.slice(0,depth+1),value:value});promote(model._root,node)}},{"./../get/util/clone":46,"./../lru/promote":57}],42:[function(require,module,exports){var support=require("./util/support");var fastCopy=support.fastCopy;module.exports=function onMissing(model,path,depth,outerResults,requestedPath,optimizedPath,optimizedLength){var pathSlice;if(!outerResults.requestedMissingPaths){outerResults.requestedMissingPaths=[];outerResults.optimizedMissingPaths=[]}if(depth<path.length){pathSlice=fastCopy(path,depth)}else{pathSlice=[]}concatAndInsertMissing(model,pathSlice,depth,requestedPath,optimizedPath,optimizedLength,outerResults)};function concatAndInsertMissing(model,remainingPath,depth,requestedPath,optimizedPath,optimizedLength,results){results.requestedMissingPaths.push(requestedPath.slice(0,depth).concat(remainingPath));results.optimizedMissingPaths.push(optimizedPath.slice(0,optimizedLength).concat(remainingPath))}},{"./util/support":49}],43:[function(require,module,exports){var promote=require("./../lru/promote");var clone=require("./util/clone");var $ref=require("./../types/ref");var $atom=require("./../types/atom");var $error=require("./../types/error");module.exports=function onValue(model,node,seed,depth,outerResults,branchInfo,requestedPath,optimizedPath,optimizedLength,isJSONG){if(node){promote(model._root,node)}if(!seed){return}var i,len,k,key,curr,prev=null,prevK;var materialized=false,valueNode;if(!node||node.value===undefined){materialized=model._materialized}if(materialized){valueNode={$type:$atom}}else if(model._boxed){valueNode=clone(node)}else if(node.$type===$ref||node.$type===$error){if(isJSONG){valueNode=clone(node)}else{valueNode=node.value}}else if(isJSONG){var isObject=node.value&&typeof node.value==="object";var isUserCreatedNode=!node.ツmodelCreated;if(isObject||isUserCreatedNode){valueNode=clone(node)}else{valueNode=node.value}}else{valueNode=node.value}if(outerResults){outerResults.hasValue=true}if(isJSONG){curr=seed.jsonGraph;if(!curr){curr=seed.jsonGraph={};seed.paths=[]}for(i=0,len=optimizedLength-1;i<len;i++){key=optimizedPath[i];if(!curr[key]){curr[key]={}}curr=curr[key]}key=optimizedPath[i];curr[key]=materialized?{$type:$atom}:valueNode;if(requestedPath){seed.paths.push(requestedPath.slice(0,depth))}}else if(depth===0){seed.json=valueNode}else{curr=seed.json;if(!curr){curr=seed.json={}}for(i=0;i<depth-1;i++){k=requestedPath[i];if(!curr[k]){curr[k]=branchInfo[i]}prev=curr;prevK=k;curr=curr[k]}k=requestedPath[i];if(k!==null){curr[k]=valueNode}else{prev[prevK]=valueNode}}}},{"./../lru/promote":57,"./../types/atom":126,"./../types/error":127,"./../types/ref":128,"./util/clone":46}],44:[function(require,module,exports){var isExpired=require("./util/isExpired");var $error=require("./../types/error");var onError=require("./onError");var onValue=require("./onValue");var onMissing=require("./onMissing");var isMaterialized=require("./util/isMaterialzed");var expireNode=require("./../support/expireNode");module.exports=function onValueType(model,node,path,depth,seed,outerResults,branchInfo,requestedPath,optimizedPath,optimizedLength,isJSONG,fromReference){var currType=node&&node.$type;var requiresMaterializedToReport=node&&node.value===undefined;if(!node||!currType){if(isMaterialized(model)){onValue(model,node,seed,depth,outerResults,branchInfo,requestedPath,optimizedPath,optimizedLength,isJSONG)}else{onMissing(model,path,depth,outerResults,requestedPath,optimizedPath,optimizedLength)}return}else if(isExpired(node)){if(!node.ツinvalidated){expireNode(node,model._root.expired,model._root)}onMissing(model,path,depth,outerResults,requestedPath,optimizedPath,optimizedLength)}else if(currType===$error){if(fromReference){requestedPath[depth]=null}if(isJSONG||model._treatErrorsAsValues){onValue(model,node,seed,depth,outerResults,branchInfo,requestedPath,optimizedPath,optimizedLength,isJSONG)}else{onError(model,node,depth,requestedPath,outerResults)}}else{if(fromReference){requestedPath[depth]=null}if(!requiresMaterializedToReport||requiresMaterializedToReport&&model._materialized){onValue(model,node,seed,depth,outerResults,branchInfo,requestedPath,optimizedPath,optimizedLength,isJSONG)}}}},{"./../support/expireNode":94,"./../types/error":127,"./onError":41,"./onMissing":42,"./onValue":43,"./util/isExpired":47,"./util/isMaterialzed":48}],45:[function(require,module,exports){var pathSyntax=require("falcor-path-syntax");module.exports=function getValueSync(pathArg){var path=pathSyntax.fromPath(pathArg);if(Array.isArray(path)===false){throw new Error("Model#getValueSync must be called with an Array path.")}if(this._path.length){path=this._path.concat(path)}return this._syncCheck("getValueSync")&&this._getValueSync(this,path).value}},{"falcor-path-syntax":11}],46:[function(require,module,exports){var unicodePrefix=require("./../../internal/unicodePrefix");module.exports=function clone(node){var outValue,i,len;var keys=Object.keys(node);outValue={};for(i=0,len=keys.length;i<len;i++){var k=keys[i];var k0=k.charAt(0);if(k0===unicodePrefix){continue}outValue[k]=node[k]}return outValue}},{"./../../internal/unicodePrefix":53}],47:[function(require,module,exports){var now=require("./../../support/now");module.exports=function isExpired(node){var $expires=node.$expires===void 0&&-1||node.$expires;return $expires!==-1&&$expires!==1&&($expires===0||$expires<now())}},{"./../../support/now":114}],48:[function(require,module,exports){module.exports=function isMaterialized(model){return model._materialized&&!model._source}},{}],49:[function(require,module,exports){function fastCopy(arr,iArg){var a=[],len,j,i;for(j=0,i=iArg||0,len=arr.length;i<len;j++,i++){a[j]=arr[i]}return a}function fastCat(arr1,arr2){var a=[],i,len,j;for(i=0,len=arr1.length;i<len;i++){a[i]=arr1[i]}for(j=0,len=arr2.length;j<len;j++){a[i++]=arr2[j]}return a}module.exports={fastCat:fastCat,fastCopy:fastCopy}},{}],50:[function(require,module,exports){var followReference=require("./followReference");var onValueType=require("./onValueType");var onValue=require("./onValue");var isExpired=require("./util/isExpired");var iterateKeySet=require("falcor-path-utils").iterateKeySet;var $ref=require("./../types/ref");var NullInPathError=require("./../errors/NullInPathError");var promote=require("./../lru/promote");module.exports=function walkPath(model,root,curr,path,depth,seed,outerResults,branchInfo,requestedPath,optimizedPathArg,optimizedLength,isJSONG,fromReferenceArg,referenceContainerArg){var fromReference=fromReferenceArg;var optimizedPath=optimizedPathArg;var referenceContainer=referenceContainerArg;if(!curr||curr&&curr.$type||depth===path.length){onValueType(model,curr,path,depth,seed,outerResults,branchInfo,requestedPath,optimizedPath,optimizedLength,isJSONG,fromReference);return}var keySet,i;keySet=path[depth];var isKeySet=typeof keySet==="object";var nextDepth=depth+1;var iteratorNote=false;var key=keySet;var allowFromWhenceYouCame=model._allowFromWhenceYouCame;if(isKeySet){iteratorNote={};key=iterateKeySet(keySet,iteratorNote)}if(key===undefined&&iteratorNote.done){return}var optimizedLengthPlus1=optimizedLength+1;var refPath;do{fromReference=false;var next;if(key===null){if(depth<path.length){throw new NullInPathError}else{next=curr}}else{next=curr[key];optimizedPath[optimizedLength]=key;requestedPath[depth]=key}var nextOptimizedPath=optimizedPath;var nextOptimizedLength=optimizedLengthPlus1;if(next){var nType=next.$type;var value=nType&&next.value||next;if(nextDepth<path.length&&nType&&nType===$ref&&!isExpired(next)){promote(model._root,next);if(isJSONG){onValue(model,next,seed,nextDepth,outerResults,null,null,optimizedPath,nextOptimizedLength,isJSONG)}var ref=followReference(model,root,root,next,value,seed,isJSONG);fromReference=true;next=ref[0];refPath=ref[1];referenceContainer=ref[2];nextOptimizedPath=[];nextOptimizedLength=refPath.length;for(i=0;i<nextOptimizedLength;++i){nextOptimizedPath[i]=refPath[i]}}if(next){var obj;if(referenceContainer&&allowFromWhenceYouCame){obj={$__path:next.ツabsolutePath,$__refPath:referenceContainer.value,$__toReference:referenceContainer.ツabsolutePath}}else{obj={$__path:next.ツabsolutePath}}branchInfo[depth]=obj}}walkPath(model,root,next,path,nextDepth,seed,outerResults,branchInfo,requestedPath,nextOptimizedPath,nextOptimizedLength,isJSONG,fromReference,referenceContainer);if(iteratorNote&&!iteratorNote.done){key=iterateKeySet(keySet,iteratorNote)}}while(iteratorNote&&!iteratorNote.done)}},{"./../errors/NullInPathError":31,"./../lru/promote":57,"./../types/ref":128,"./followReference":32,"./onValue":43,"./onValueType":44,"./util/isExpired":47,"falcor-path-utils":136}],51:[function(require,module,exports){"use strict";function falcor(opts){return new falcor.Model(opts)}falcor.keys=function getJSONKeys(json){if(!json){return undefined}return Object.keys(json).filter(function(key){return key!=="$__path"})};if(typeof Promise==="function"){falcor.Promise=Promise}else{falcor.Promise=require("promise")}module.exports=falcor;falcor.Model=require("./Model")},{"./Model":20,promise:143}],52:[function(require,module,exports){module.exports=require("./unicodePrefix")+"ref"},{"./unicodePrefix":53}],53:[function(require,module,exports){module.exports="ツ"},{}],54:[function(require,module,exports){var createHardlink=require("../support/createHardlink");var __prefix=require("./../internal/unicodePrefix");var $ref=require("./../types/ref");var getBoundValue=require("./../get/getBoundValue");var promote=require("./../lru/promote");var getSize=require("./../support/getSize");var hasOwn=require("./../support/hasOwn");var isObject=require("./../support/isObject");var isExpired=require("./../support/isExpired");var isFunction=require("./../support/isFunction");var isPrimitive=require("./../support/isPrimitive");var expireNode=require("./../support/expireNode");var incrementVersion=require("./../support/incrementVersion");var updateNodeAncestors=require("./../support/updateNodeAncestors");var removeNodeAndDescendants=require("./../support/removeNodeAndDescendants");module.exports=function invalidatePathMaps(model,pathMapEnvelopes){var modelRoot=model._root;var lru=modelRoot;var expired=modelRoot.expired;var version=incrementVersion();var comparator=modelRoot._comparator;var errorSelector=modelRoot._errorSelector;var bound=model._path;var cache=modelRoot.cache;var node=bound.length?getBoundValue(model,bound).value:cache;var parent=node.ツparent||cache;var initialVersion=cache.ツversion;var pathMapIndex=-1;var pathMapCount=pathMapEnvelopes.length;while(++pathMapIndex<pathMapCount){var pathMapEnvelope=pathMapEnvelopes[pathMapIndex];invalidatePathMap(pathMapEnvelope.json,0,cache,parent,node,version,expired,lru,comparator,errorSelector)}var newVersion=cache.ツversion;var rootChangeHandler=modelRoot.onChange;if(isFunction(rootChangeHandler)&&initialVersion!==newVersion){rootChangeHandler()}};function invalidatePathMap(pathMap,depth,root,parent,node,version,expired,lru,comparator,errorSelector){if(isPrimitive(pathMap)||pathMap.$type){return}for(var key in pathMap){if(key[0]!==__prefix&&key[0]!=="$"&&hasOwn(pathMap,key)){var child=pathMap[key];var branch=isObject(child)&&!child.$type;var results=invalidateNode(root,parent,node,key,child,branch,false,version,expired,lru,comparator,errorSelector);var nextNode=results[0];var nextParent=results[1];if(nextNode){if(branch){invalidatePathMap(child,depth+1,root,nextParent,nextNode,version,expired,lru,comparator,errorSelector)}else if(removeNodeAndDescendants(nextNode,nextParent,key,lru)){updateNodeAncestors(nextParent,getSize(nextNode),lru,version)}}}}}function invalidateReference(value,root,node,version,expired,lru,comparator,errorSelector){if(isExpired(node)){expireNode(node,expired,lru);return[undefined,root]}promote(lru,node);var container=node;var reference=node.value;var parent=root;node=node.ツcontext;if(node!=null){parent=node.ツparent||root}else{var index=0;var count=reference.length-1;parent=node=root;do{var key=reference[index];var branch=index<count;var results=invalidateNode(root,parent,node,key,value,branch,true,version,expired,lru,comparator,errorSelector);
node=results[0];if(isPrimitive(node)){return results}parent=results[1]}while(index++<count);if(container.ツcontext!==node){createHardlink(container,node)}}return[node,parent]}function invalidateNode(root,parent,node,key,value,branch,reference,version,expired,lru,comparator,errorSelector){var type=node.$type;while(type===$ref){var results=invalidateReference(value,root,node,version,expired,lru,comparator,errorSelector);node=results[0];if(isPrimitive(node)){return results}parent=results[1];type=node&&node.$type}if(type!==void 0){return[node,parent]}if(key==null){if(branch){throw new Error("`null` is not allowed in branch key positions.")}else if(node){key=node.ツkey}}else{parent=node;node=parent[key]}return[node,parent]}},{"../support/createHardlink":93,"./../get/getBoundValue":34,"./../internal/unicodePrefix":53,"./../lru/promote":57,"./../support/expireNode":94,"./../support/getSize":96,"./../support/hasOwn":99,"./../support/incrementVersion":100,"./../support/isExpired":103,"./../support/isFunction":104,"./../support/isObject":108,"./../support/isPrimitive":110,"./../support/removeNodeAndDescendants":117,"./../support/updateNodeAncestors":123,"./../types/ref":128}],55:[function(require,module,exports){var __ref=require("./../internal/ref");var $ref=require("./../types/ref");var getBoundValue=require("./../get/getBoundValue");var promote=require("./../lru/promote");var getSize=require("./../support/getSize");var isExpired=require("./../support/isExpired");var isFunction=require("./../support/isFunction");var isPrimitive=require("./../support/isPrimitive");var expireNode=require("./../support/expireNode");var iterateKeySet=require("falcor-path-utils").iterateKeySet;var incrementVersion=require("./../support/incrementVersion");var updateNodeAncestors=require("./../support/updateNodeAncestors");var removeNodeAndDescendants=require("./../support/removeNodeAndDescendants");module.exports=function invalidatePathSets(model,paths){var modelRoot=model._root;var lru=modelRoot;var expired=modelRoot.expired;var version=incrementVersion();var bound=model._path;var cache=modelRoot.cache;var node=bound.length?getBoundValue(model,bound).value:cache;var parent=node.ツparent||cache;var initialVersion=cache.ツversion;var pathIndex=-1;var pathCount=paths.length;while(++pathIndex<pathCount){var path=paths[pathIndex];invalidatePathSet(path,0,cache,parent,node,version,expired,lru)}var newVersion=cache.ツversion;var rootChangeHandler=modelRoot.onChange;if(isFunction(rootChangeHandler)&&initialVersion!==newVersion){rootChangeHandler()}};function invalidatePathSet(path,depth,root,parent,node,version,expired,lru){var note={};var branch=depth<path.length-1;var keySet=path[depth];var key=iterateKeySet(keySet,note);do{var results=invalidateNode(root,parent,node,key,branch,false,version,expired,lru);var nextNode=results[0];var nextParent=results[1];if(nextNode){if(branch){invalidatePathSet(path,depth+1,root,nextParent,nextNode,version,expired,lru)}else if(removeNodeAndDescendants(nextNode,nextParent,key,lru)){updateNodeAncestors(nextParent,getSize(nextNode),lru,version)}}key=iterateKeySet(keySet,note)}while(!note.done)}function invalidateReference(root,node,version,expired,lru){if(isExpired(node)){expireNode(node,expired,lru);return[undefined,root]}promote(lru,node);var container=node;var reference=node.value;var parent=root;node=node.ツcontext;if(node!=null){parent=node.ツparent||root}else{var index=0;var count=reference.length-1;parent=node=root;do{var key=reference[index];var branch=index<count;var results=invalidateNode(root,parent,node,key,branch,true,version,expired,lru);node=results[0];if(isPrimitive(node)){return results}parent=results[1]}while(index++<count);if(container.ツcontext!==node){var backRefs=node.ツrefsLength||0;node.ツrefsLength=backRefs+1;node[__ref+backRefs]=container;container.ツcontext=node;container.ツrefIndex=backRefs}}return[node,parent]}function invalidateNode(root,parent,node,key,branch,reference,version,expired,lru){var type=node.$type;while(type===$ref){var results=invalidateReference(root,node,version,expired,lru);node=results[0];if(isPrimitive(node)){return results}parent=results[1];type=node.$type}if(type!==void 0){return[node,parent]}if(key==null){if(branch){throw new Error("`null` is not allowed in branch key positions.")}else if(node){key=node.ツkey}}else{parent=node;node=parent[key]}return[node,parent]}},{"./../get/getBoundValue":34,"./../internal/ref":52,"./../lru/promote":57,"./../support/expireNode":94,"./../support/getSize":96,"./../support/incrementVersion":100,"./../support/isExpired":103,"./../support/isFunction":104,"./../support/isPrimitive":110,"./../support/removeNodeAndDescendants":117,"./../support/updateNodeAncestors":123,"./../types/ref":128,"falcor-path-utils":136}],56:[function(require,module,exports){var removeNode=require("./../support/removeNode");var updateNodeAncestors=require("./../support/updateNodeAncestors");module.exports=function collect(lru,expired,totalArg,max,ratioArg,version){var total=totalArg;var ratio=ratioArg;if(typeof ratio!=="number"){ratio=.75}var shouldUpdate=typeof version==="number";var targetSize=max*ratio;var parent,node,size;node=expired.pop();while(node){size=node.$size||0;total-=size;if(shouldUpdate===true){updateNodeAncestors(node,size,lru,version)}else if(parent=node.ツparent){removeNode(node,parent,node.ツkey,lru)}node=expired.pop()}if(total>=max){var prev=lru.ツtail;node=prev;while(total>=targetSize&&node){prev=prev.ツprev;size=node.$size||0;total-=size;if(shouldUpdate===true){updateNodeAncestors(node,size,lru,version)}node=prev}lru.ツtail=lru.ツprev=node;if(node==null){lru.ツhead=lru.ツnext=undefined}else{node.ツnext=undefined}}}},{"./../support/removeNode":116,"./../support/updateNodeAncestors":123}],57:[function(require,module,exports){var EXPIRES_NEVER=require("./../values/expires-never");module.exports=function lruPromote(root,object){if(object.$expires===EXPIRES_NEVER){return}var head=root.ツhead;if(!head){root.ツhead=root.ツtail=object;return}if(head===object){return}var prev=object.ツprev;var next=object.ツnext;if(next){next.ツprev=prev}if(prev){prev.ツnext=next}object.ツprev=undefined;root.ツhead=object;object.ツnext=head;head.ツprev=object;if(object===root.ツtail){root.ツtail=prev}}},{"./../values/expires-never":129}],58:[function(require,module,exports){module.exports=function lruSplice(root,object){var prev=object.ツprev;var next=object.ツnext;if(next){next.ツprev=prev}if(prev){prev.ツnext=next}object.ツprev=object.ツnext=undefined;if(object===root.ツhead){root.ツhead=next}if(object===root.ツtail){root.ツtail=prev}}},{}],59:[function(require,module,exports){var complement=require("./complement");var flushGetRequest=require("./flushGetRequest");var REQUEST_ID=0;var GetRequestType=require("./RequestTypes").GetRequest;var setJSONGraphs=require("./../set/setJSONGraphs");var setPathValues=require("./../set/setPathValues");var $error=require("./../types/error");var emptyArray=[];var InvalidSourceError=require("./../errors/InvalidSourceError");var GetRequestV2=function(scheduler,requestQueue){this.sent=false;this.scheduled=false;this.requestQueue=requestQueue;this.id=++REQUEST_ID;this.type=GetRequestType;this._scheduler=scheduler;this._pathMap={};this._optimizedPaths=[];this._requestedPaths=[];this._callbacks=[];this._count=0;this._disposable=null;this._collapsed=null;this._disposed=false};GetRequestV2.prototype={batch:function(requestedPaths,optimizedPaths,callback){var self=this;var oPaths=self._optimizedPaths;var rPaths=self._requestedPaths;var callbacks=self._callbacks;var idx=oPaths.length;oPaths[idx]=optimizedPaths;rPaths[idx]=requestedPaths;callbacks[idx]=callback;++self._count;if(!self.scheduled){self.scheduled=true;var flushedDisposable;var scheduleDisposable=self._scheduler.schedule(function(){flushedDisposable=flushGetRequest(self,oPaths,function(err,data){var i,fn,len;self.requestQueue.removeRequest(self);self._disposed=true;if(err instanceof InvalidSourceError){for(i=0,len=callbacks.length;i<len;++i){fn=callbacks[i];if(fn){fn(err)}}return}if(self._count){self._merge(rPaths,err,data);for(i=0,len=callbacks.length;i<len;++i){fn=callbacks[i];if(fn){fn(err,data)}}}})});self._disposable=flushedDisposable||scheduleDisposable}return createDisposable(self,idx)},add:function(requested,optimized,callback){var self=this;var complementTuple=complement(requested,optimized,self._pathMap);var optimizedComplement;var requestedComplement;if(complementTuple){requestedComplement=complementTuple[2];optimizedComplement=complementTuple[1]}else{requestedComplement=requested;optimizedComplement=optimized}var inserted=false;var disposable=false;if(optimizedComplement.length<optimized.length){inserted=true;var idx=self._callbacks.length;self._callbacks[idx]=callback;self._requestedPaths[idx]=complementTuple[0];self._optimizedPaths[idx]=[];++self._count;disposable=createDisposable(self,idx)}return[inserted,requestedComplement,optimizedComplement,disposable]},_merge:function(requested,err,data){var self=this;var model=self.requestQueue.model;var modelRoot=model._root;var errorSelector=modelRoot.errorSelector;var comparator=modelRoot.comparator;var boundPath=model._path;model._path=emptyArray;var nextPaths=flattenRequestedPaths(requested);if(err){var error=err;if(error instanceof Error){error={message:error.message}}if(!error.$type){error={$type:$error,value:error}}var pathValues=nextPaths.map(function(x){return{path:x,value:error}});setPathValues(model,pathValues,null,errorSelector,comparator)}else{setJSONGraphs(model,[{paths:nextPaths,jsonGraph:data.jsonGraph}],null,errorSelector,comparator)}model._path=boundPath}};function createDisposable(request,idx){var disposed=false;return function(){if(disposed||request._disposed){return}disposed=true;request._callbacks[idx]=null;request._optimizedPaths[idx]=[];request._requestedPaths[idx]=[];var count=--request._count;if(count===0){request._disposable.dispose();request.requestQueue.removeRequest(request)}}}function flattenRequestedPaths(requested){var out=[];var outLen=-1;for(var i=0,len=requested.length;i<len;++i){var paths=requested[i];for(var j=0,innerLen=paths.length;j<innerLen;++j){out[++outLen]=paths[j]}}return out}module.exports=GetRequestV2},{"./../errors/InvalidSourceError":29,"./../set/setJSONGraphs":83,"./../set/setPathValues":85,"./../types/error":127,"./RequestTypes":61,"./complement":62,"./flushGetRequest":63}],60:[function(require,module,exports){var RequestTypes=require("./RequestTypes");var sendSetRequest=require("./sendSetRequest");var GetRequest=require("./GetRequestV2");var falcorPathUtils=require("falcor-path-utils");function RequestQueueV2(model,scheduler){this.model=model;this.scheduler=scheduler;this.requests=this._requests=[]}RequestQueueV2.prototype={setScheduler:function(scheduler){this.scheduler=scheduler},set:function(jsonGraph,cb){jsonGraph.paths=falcorPathUtils.collapse(jsonGraph.paths);return sendSetRequest(jsonGraph,this.model,cb)},get:function(requestedPaths,optimizedPaths,cb){var self=this;var disposables=[];var count=0;var requests=self._requests;var i,len;var oRemainingPaths=optimizedPaths;var rRemainingPaths=requestedPaths;var disposed=false;var request;for(i=0,len=requests.length;i<len;++i){request=requests[i];if(request.type!==RequestTypes.GetRequest){continue}if(request.sent){var results=request.add(rRemainingPaths,oRemainingPaths,refCountCallback);if(results[0]){rRemainingPaths=results[1];oRemainingPaths=results[2];disposables[disposables.length]=results[3];++count}}else{request.batch(rRemainingPaths,oRemainingPaths,refCountCallback);oRemainingPaths=[];rRemainingPaths=[];++count}if(!oRemainingPaths.length){break}}if(oRemainingPaths.length){request=new GetRequest(self.scheduler,self);requests[requests.length]=request;++count;var disposable=request.batch(rRemainingPaths,oRemainingPaths,refCountCallback);disposables[disposables.length]=disposable}function refCountCallback(err){if(disposed){return}--count;if(count===0){cb(err)}}return function(){if(disposed||count===0){return}disposed=true;var length=disposables.length;for(var idx=0;idx<length;++idx){disposables[idx]()}}},removeRequest:function(request){var requests=this._requests;var i=requests.length;while(--i>=0){if(requests[i].id===request.id){requests.splice(i,1);break}}}};module.exports=RequestQueueV2},{"./GetRequestV2":59,"./RequestTypes":61,"./sendSetRequest":64,"falcor-path-utils":136}],61:[function(require,module,exports){module.exports={GetRequest:"GET"}},{}],62:[function(require,module,exports){var hasIntersection=require("falcor-path-utils").hasIntersection;var arraySlice=require("./../support/array-slice");module.exports=function complement(requested,optimized,tree){var optimizedComplement=[];var requestedComplement=[];var requestedIntersection=[];var intersectionLength=-1,complementLength=-1;var intersectionFound=false;for(var i=0,len=optimized.length;i<len;++i){var path=optimized[i];var subTree=tree[path.length];if(!subTree||!hasIntersection(subTree,path,0)){if(intersectionFound){optimizedComplement[++complementLength]=path;requestedComplement[complementLength]=requested[i]}}else{if(!intersectionFound&&i>0){requestedComplement=arraySlice(requested,0,i);optimizedComplement=arraySlice(optimized,0,i)}requestedIntersection[++intersectionLength]=requested[i];intersectionFound=true}}if(!intersectionFound){return null}return[requestedIntersection,optimizedComplement,requestedComplement]}},{"./../support/array-slice":91,"falcor-path-utils":136}],63:[function(require,module,exports){var pathUtils=require("falcor-path-utils");var toTree=pathUtils.toTree;var toPaths=pathUtils.toPaths;var InvalidSourceError=require("./../errors/InvalidSourceError");module.exports=function flushGetRequest(request,listOfPaths,callback){if(request._count===0){request.requestQueue.removeRequest(request);return null}request.sent=true;request.scheduled=false;var pathMap=request._pathMap;var listKeys=Object.keys(listOfPaths);var listIdx=0,listLen=listKeys.length;for(;listIdx<listLen;++listIdx){var paths=listOfPaths[listIdx];for(var j=0,pathLen=paths.length;j<pathLen;++j){var pathSet=paths[j];var len=pathSet.length;if(!pathMap[len]){pathMap[len]=[pathSet]}else{var pathSetsByLength=pathMap[len];pathSetsByLength[pathSetsByLength.length]=pathSet}}}var pathMapKeys=Object.keys(pathMap);var pathMapIdx=0,pathMapLen=pathMapKeys.length;for(;pathMapIdx<pathMapLen;++pathMapIdx){var pathMapKey=pathMapKeys[pathMapIdx];pathMap[pathMapKey]=toTree(pathMap[pathMapKey])}var collapsedPaths=request._collasped=toPaths(pathMap);var jsonGraphData;var getRequest;try{getRequest=request.requestQueue.model._source.get(collapsedPaths)}catch(e){callback(new InvalidSourceError);return null}var disposable=getRequest.subscribe(function(data){jsonGraphData=data},function(err){callback(err,jsonGraphData)},function(){callback(null,jsonGraphData)});return disposable}},{"./../errors/InvalidSourceError":29,"falcor-path-utils":136}],64:[function(require,module,exports){var arrayMap=require("./../support/array-map");var setJSONGraphs=require("./../set/setJSONGraphs");var setPathValues=require("./../set/setPathValues");var InvalidSourceError=require("./../errors/InvalidSourceError");var emptyArray=[];var emptyDisposable={dispose:function(){}};var sendSetRequest=function(originalJsonGraph,model,callback){var paths=originalJsonGraph.paths;var modelRoot=model._root;var errorSelector=modelRoot.errorSelector;var comparator=modelRoot.comparator;var boundPath=model._path;var resultingJsonGraphEnvelope;var setObservable;try{setObservable=model._source.set(originalJsonGraph)}catch(e){callback(new InvalidSourceError);return emptyDisposable}var disposable=setObservable.subscribe(function onNext(jsonGraphEnvelope){if(disposable&&disposable.disposed){return}model._path=emptyArray;var successfulPaths=setJSONGraphs(model,[{paths:paths,jsonGraph:jsonGraphEnvelope.jsonGraph}],null,errorSelector,comparator);jsonGraphEnvelope.paths=successfulPaths[1];model._path=boundPath;resultingJsonGraphEnvelope=jsonGraphEnvelope},function onError(dataSourceError){if(disposable&&disposable.disposed){return}model._path=emptyArray;setPathValues(model,arrayMap(paths,function(path){return{path:path,value:dataSourceError}}),null,errorSelector,comparator);model._path=boundPath;callback(dataSourceError)},function onCompleted(){callback(null,resultingJsonGraphEnvelope)});return disposable};module.exports=sendSetRequest},{"./../errors/InvalidSourceError":29,"./../set/setJSONGraphs":83,"./../set/setPathValues":85,"./../support/array-map":90}],65:[function(require,module,exports){var AssignableDisposable=function AssignableDisposable(disosableCallback){this.disposed=false;this.currentDisposable=disosableCallback};AssignableDisposable.prototype={dispose:function dispose(){if(this.disposed||!this.currentDisposable){return}this.disposed=true;var currentDisposable=this.currentDisposable;if(currentDisposable.dispose){currentDisposable.dispose()}else{currentDisposable()}}};module.exports=AssignableDisposable},{}],66:[function(require,module,exports){var ModelResponse=require("./../response/ModelResponse");var InvalidSourceError=require("./../errors/InvalidSourceError");var pathSyntax=require("falcor-path-syntax");function CallResponse(model,callPath,args,suffix,paths){this.callPath=pathSyntax.fromPath(callPath);this.args=args;if(paths){this.paths=paths.map(pathSyntax.fromPath)}if(suffix){this.suffix=suffix.map(pathSyntax.fromPath)}this.model=model}CallResponse.prototype=Object.create(ModelResponse.prototype);CallResponse.prototype._subscribe=function _subscribe(observer){var callPath=this.callPath;var callArgs=this.args;var suffixes=this.suffix;var extraPaths=this.paths;var model=this.model;var rootModel=model._clone({_path:[]});var boundPath=model._path;var boundCallPath=boundPath.concat(callPath);if(!model._source){observer.onError(new Error("function does not exist"));return}var response,obs;try{obs=model._source.call(boundCallPath,callArgs,suffixes,extraPaths)}catch(e){observer.onError(new InvalidSourceError(e));return}return obs.subscribe(function(res){response=res},function(err){observer.onError(err)},function(){var invalidations=response.invalidated;if(invalidations&&invalidations.length){rootModel.invalidate.apply(rootModel,invalidations)}rootModel.withoutDataSource().set(response).subscribe(function(x){observer.onNext(x)},function(err){observer.onError(err)},function(){observer.onCompleted()})})};module.exports=CallResponse},{"./../errors/InvalidSourceError":29,"./../response/ModelResponse":68,"falcor-path-syntax":11}],67:[function(require,module,exports){var isArray=Array.isArray;var ModelResponse=require("./ModelResponse");var isPathValue=require("./../support/isPathValue");var isJSONEnvelope=require("./../support/isJSONEnvelope");var empty={dispose:function(){}};function InvalidateResponse(model,args){this._model=model;var groups=[];var group,groupType;var argIndex=-1;var argCount=args.length;while(++argIndex<argCount){var arg=args[argIndex];var argType;if(isArray(arg)){argType="PathValues"}else if(isPathValue(arg)){argType="PathValues"}else if(isJSONEnvelope(arg)){argType="PathMaps"}else{throw new Error("Invalid Input")}if(groupType!==argType){groupType=argType;group={inputType:argType,arguments:[]};groups.push(group)}group.arguments.push(arg)}this._groups=groups}InvalidateResponse.prototype=Object.create(ModelResponse.prototype);InvalidateResponse.prototype.progressively=function progressively(){return this};InvalidateResponse.prototype._toJSONG=function _toJSONG(){return this};InvalidateResponse.prototype._subscribe=function _subscribe(observer){var model=this._model;this._groups.forEach(function(group){var inputType=group.inputType;var methodArgs=group.arguments;var operationName="_invalidate"+inputType;var operationFunc=model[operationName];operationFunc(model,methodArgs)});observer.onCompleted();return empty};module.exports=InvalidateResponse},{"./../support/isJSONEnvelope":106,"./../support/isPathValue":109,"./ModelResponse":68}],68:[function(require,module,exports){var falcor=require("./../");var noop=require("./../support/noop");function ModelResponse(subscribe){this._subscribe=subscribe}ModelResponse.prototype._toJSONG=function toJSONG(){return this};ModelResponse.prototype.progressively=function progressively(){return this};ModelResponse.prototype.subscribe=ModelResponse.prototype.forEach=function subscribe(a,b,c){var observer=a;if(!observer||typeof observer!=="object"){observer={onNext:a||noop,onError:b||noop,onCompleted:c||noop}}var subscription=this._subscribe(observer);switch(typeof subscription){case"function":return{dispose:subscription};case"object":return subscription||{dispose:noop};default:return{dispose:noop}}};ModelResponse.prototype.then=function then(onNext,onError){var self=this;return new falcor.Promise(function(resolve,reject){var rejected=false;var values=[];self.subscribe(function(value){values[values.length]=value},function(errors){rejected=true;reject(errors)},function(){var value=values;if(values.length<=1){value=values[0]}if(rejected===false){resolve(value)}})}).then(onNext,onError)};module.exports=ModelResponse},{"./../":51,"./../support/noop":113}],69:[function(require,module,exports){var ModelResponse=require("./../ModelResponse");var checkCacheAndReport=require("./checkCacheAndReport");var getRequestCycle=require("./getRequestCycle");var empty={dispose:function(){}};var collectLru=require("./../../lru/collect");var getSize=require("./../../support/getSize");var GetResponse=module.exports=function GetResponse(model,paths,isJSONGraph,isProgressive,forceCollect){this.model=model;this.currentRemainingPaths=paths;this.isJSONGraph=isJSONGraph||false;this.isProgressive=isProgressive||false;this.forceCollect=forceCollect||false};GetResponse.prototype=Object.create(ModelResponse.prototype);GetResponse.prototype._toJSONG=function _toJSONGraph(){return new GetResponse(this.model,this.currentRemainingPaths,true,this.isProgressive,this.forceCollect)};GetResponse.prototype.progressively=function progressively(){return new GetResponse(this.model,this.currentRemainingPaths,this.isJSONGraph,true,this.forceCollect)};GetResponse.prototype._subscribe=function _subscribe(observer){var seed=[{}];var errors=[];var model=this.model;var isJSONG=observer.isJSONG=this.isJSONGraph;var isProgressive=this.isProgressive;var results=checkCacheAndReport(model,this.currentRemainingPaths,observer,isProgressive,isJSONG,seed,errors);if(!results){if(this.forceCollect){var modelRoot=model._root;var modelCache=modelRoot.cache;var currentVersion=modelCache.ツversion;collectLru(modelRoot,modelRoot.expired,getSize(modelCache),model._maxSize,model._collectRatio,currentVersion)}return empty}return getRequestCycle(this,model,results,observer,seed,errors,1)}},{"./../../lru/collect":56,"./../../support/getSize":96,"./../ModelResponse":68,"./checkCacheAndReport":70,"./getRequestCycle":71}],70:[function(require,module,exports){var gets=require("./../../get");var getWithPathsAsJSONGraph=gets.getWithPathsAsJSONGraph;var getWithPathsAsPathMap=gets.getWithPathsAsPathMap;module.exports=function checkCacheAndReport(model,requestedPaths,observer,progressive,isJSONG,seed,errors){var results;if(isJSONG){results=getWithPathsAsJSONGraph(model,requestedPaths,seed)}else{results=getWithPathsAsPathMap(model,requestedPaths,seed)}if(results.criticalError){observer.onError(results.criticalError);return null}var hasValues=results.hasValue;var completed=!results.requestedMissingPaths||!model._source;var hasValueOverall=Boolean(seed[0].json||seed[0].jsonGraph);if(results.errors){var errs=results.errors;var errorsLength=errors.length;for(var i=0,len=errs.length;i<len;++i,++errorsLength){errors[errorsLength]=errs[i]}}if(hasValues&&progressive||hasValueOverall&&completed){try{observer.onNext(seed[0])}catch(e){throw e}}if(completed){if(errors.length){observer.onError(errors)}else{observer.onCompleted()}return null}return results}},{"./../../get":40}],71:[function(require,module,exports){var checkCacheAndReport=require("./checkCacheAndReport");var MaxRetryExceededError=require("./../../errors/MaxRetryExceededError");var fastCat=require("./../../get/util/support").fastCat;var collectLru=require("./../../lru/collect");var getSize=require("./../../support/getSize");var AssignableDisposable=require("./../AssignableDisposable");var InvalidSourceError=require("../../errors/InvalidSourceError");module.exports=function getRequestCycle(getResponse,model,results,observer,seed,errors,count){if(count===10){throw new MaxRetryExceededError}var requestQueue=model._request;var requestedMissingPaths=results.requestedMissingPaths;var optimizedMissingPaths=results.optimizedMissingPaths;var disposable=new AssignableDisposable;var boundRequestedMissingPaths=[];var boundPath=model._path;if(boundPath.length){for(var i=0,len=requestedMissingPaths.length;i<len;++i){boundRequestedMissingPaths[i]=fastCat(boundPath,requestedMissingPaths[i])}}else{boundRequestedMissingPaths=requestedMissingPaths}var currentRequestDisposable=requestQueue.get(boundRequestedMissingPaths,optimizedMissingPaths,function(err){if(err instanceof InvalidSourceError){observer.onError(err);return}var nextResults=checkCacheAndReport(model,requestedMissingPaths,observer,getResponse.isProgressive,getResponse.isJSONGraph,seed,errors);if(nextResults){disposable.currentDisposable=getRequestCycle(getResponse,model,nextResults,observer,seed,errors,count+1)}else{var modelRoot=model._root;var modelCache=modelRoot.cache;var currentVersion=modelCache.ツversion;collectLru(modelRoot,modelRoot.expired,getSize(modelCache),model._maxSize,model._collectRatio,currentVersion)}});disposable.currentDisposable=currentRequestDisposable;return disposable}},{"../../errors/InvalidSourceError":29,"./../../errors/MaxRetryExceededError":30,"./../../get/util/support":49,"./../../lru/collect":56,"./../../support/getSize":96,"./../AssignableDisposable":65,"./checkCacheAndReport":70}],72:[function(require,module,exports){var GetResponse=require("./GetResponse");module.exports=function getWithPaths(paths){return new GetResponse(this,paths)}},{"./GetResponse":69}],73:[function(require,module,exports){var pathSyntax=require("falcor-path-syntax");var ModelResponse=require("./../ModelResponse");var GET_VALID_INPUT=require("./validInput");var validateInput=require("./../../support/validateInput");var GetResponse=require("./GetResponse");module.exports=function get(){var out=validateInput(arguments,GET_VALID_INPUT,"get");if(out!==true){return new ModelResponse(function(o){o.onError(out)})}var paths=pathSyntax.fromPathsOrPathValues(arguments);return new GetResponse(this,paths)}},{"./../../support/validateInput":124,"./../ModelResponse":68,"./GetResponse":69,"./validInput":74,"falcor-path-syntax":11}],74:[function(require,module,exports){module.exports={path:true,pathSyntax:true}},{}],75:[function(require,module,exports){var ModelResponse=require("./../ModelResponse");var pathSyntax=require("falcor-path-syntax");var isArray=Array.isArray;var isPathValue=require("./../../support/isPathValue");var isJSONGraphEnvelope=require("./../../support/isJSONGraphEnvelope");var isJSONEnvelope=require("./../../support/isJSONEnvelope");var setRequestCycle=require("./setRequestCycle");var SetResponse=module.exports=function SetResponse(model,args,isJSONGraph,isProgressive){this._model=model;this._isJSONGraph=isJSONGraph||false;this._isProgressive=isProgressive||false;this._initialArgs=args;this._value=[{}];var groups=[];var group,groupType;var argIndex=-1;var argCount=args.length;while(++argIndex<argCount){var arg=args[argIndex];var argType;if(isArray(arg)||typeof arg==="string"){arg=pathSyntax.fromPath(arg);argType="PathValues"}else if(isPathValue(arg)){arg.path=pathSyntax.fromPath(arg.path);argType="PathValues"}else if(isJSONGraphEnvelope(arg)){argType="JSONGs"}else if(isJSONEnvelope(arg)){argType="PathMaps"}if(groupType!==argType){groupType=argType;group={inputType:argType,arguments:[]};groups.push(group)}group.arguments.push(arg)}this._groups=groups};SetResponse.prototype=Object.create(ModelResponse.prototype);SetResponse.prototype._subscribe=function _subscribe(observer){var groups=this._groups;var model=this._model;var isJSONGraph=this._isJSONGraph;var isProgressive=this._isProgressive;return setRequestCycle(model,observer,groups,isJSONGraph,isProgressive,0)};SetResponse.prototype._toJSONG=function _toJSONGraph(){return new SetResponse(this._model,this._initialArgs,true,this._isProgressive)};SetResponse.prototype.progressively=function progressively(){return new SetResponse(this._model,this._initialArgs,this._isJSONGraph,true)}},{"./../../support/isJSONEnvelope":106,"./../../support/isJSONGraphEnvelope":107,"./../../support/isPathValue":109,"./../ModelResponse":68,"./setRequestCycle":78,"falcor-path-syntax":11}],76:[function(require,module,exports){var setValidInput=require("./setValidInput");var validateInput=require("./../../support/validateInput");var SetResponse=require("./SetResponse");var ModelResponse=require("./../ModelResponse");module.exports=function set(){var out=validateInput(arguments,setValidInput,"set");if(out!==true){return new ModelResponse(function(o){o.onError(out)})}var argsIdx=-1;var argsLen=arguments.length;var args=[];while(++argsIdx<argsLen){args[argsIdx]=arguments[argsIdx]}return new SetResponse(this,args)}},{"./../../support/validateInput":124,"./../ModelResponse":68,"./SetResponse":75,"./setValidInput":79}],77:[function(require,module,exports){var arrayFlatMap=require("./../../support/array-flat-map");module.exports=function setGroupsIntoCache(model,groups){var modelRoot=model._root;var errorSelector=modelRoot.errorSelector;var groupIndex=-1;var groupCount=groups.length;var requestedPaths=[];var optimizedPaths=[];var returnValue={requestedPaths:requestedPaths,optimizedPaths:optimizedPaths};while(++groupIndex<groupCount){var group=groups[groupIndex];var inputType=group.inputType;var methodArgs=group.arguments;if(methodArgs.length>0){var operationName="_set"+inputType;var operationFunc=model[operationName];var successfulPaths=operationFunc(model,methodArgs,null,errorSelector);optimizedPaths.push.apply(optimizedPaths,successfulPaths[1]);if(inputType==="PathValues"){requestedPaths.push.apply(requestedPaths,methodArgs.map(pluckPath))}else if(inputType==="JSONGs"){requestedPaths.push.apply(requestedPaths,arrayFlatMap(methodArgs,pluckEnvelopePaths))}else{requestedPaths.push.apply(requestedPaths,successfulPaths[0])}}}return returnValue};function pluckPath(pathValue){return pathValue.path}function pluckEnvelopePaths(jsonGraphEnvelope){return jsonGraphEnvelope.paths}},{"./../../support/array-flat-map":89}],78:[function(require,module,exports){var emptyArray=[];var AssignableDisposable=require("./../AssignableDisposable");var GetResponse=require("./../get/GetResponse");var setGroupsIntoCache=require("./setGroupsIntoCache");var getWithPathsAsPathMap=require("./../../get").getWithPathsAsPathMap;var InvalidSourceError=require("./../../errors/InvalidSourceError");var MaxRetryExceededError=require("./../../errors/MaxRetryExceededError");module.exports=function setRequestCycle(model,observer,groups,isJSONGraph,isProgressive,count){if(count===10){throw new MaxRetryExceededError}var requestedAndOptimizedPaths=setGroupsIntoCache(model,groups);var optimizedPaths=requestedAndOptimizedPaths.optimizedPaths;var requestedPaths=requestedAndOptimizedPaths.requestedPaths;var isMaster=model._source===undefined;if(isMaster){return subscribeToFollowupGet(model,observer,requestedPaths,isJSONGraph,isProgressive)}if(isProgressive){var json={};getWithPathsAsPathMap(model,requestedPaths,[json]);observer.onNext(json)}var currentJSONGraph=getJSONGraph(model,optimizedPaths);var disposable=new AssignableDisposable;var requestDisposable=model._request.set(currentJSONGraph,function(error,jsonGraphEnv){if(typeof error===InvalidSourceError){return observer.onError(error)}var isCompleted=false;if(error||optimizedPaths.length===jsonGraphEnv.paths.length){isCompleted=true}if(isCompleted){disposable.currentDisposable=subscribeToFollowupGet(model,observer,requestedPaths,isJSONGraph,isProgressive);
}else{setRequestCycle(model,observer,groups,isJSONGraph,isProgressive,count+1)}});disposable.currentDisposable=requestDisposable;return disposable};function getJSONGraph(model,optimizedPaths){var boundPath=model._path;var envelope={};model._path=emptyArray;model._getPathValuesAsJSONG(model._materialize().withoutDataSource(),optimizedPaths,[envelope]);model._path=boundPath;return envelope}function subscribeToFollowupGet(model,observer,requestedPaths,isJSONGraph,isProgressive){var response=new GetResponse(model,requestedPaths,isJSONGraph,isProgressive,true);return response.subscribe(observer)}},{"./../../errors/InvalidSourceError":29,"./../../errors/MaxRetryExceededError":30,"./../../get":40,"./../AssignableDisposable":65,"./../get/GetResponse":69,"./setGroupsIntoCache":77}],79:[function(require,module,exports){module.exports={pathValue:true,pathSyntax:true,json:true,jsonGraph:true}},{}],80:[function(require,module,exports){var asap=require("asap");var empty={dispose:function(){}};function ASAPScheduler(){}ASAPScheduler.prototype.schedule=function schedule(action){asap(action);return empty};ASAPScheduler.prototype.scheduleWithState=function scheduleWithState(state,action){var self=this;asap(function(){action(self,state)});return empty};module.exports=ASAPScheduler},{asap:131}],81:[function(require,module,exports){var empty={dispose:function(){}};function ImmediateScheduler(){}ImmediateScheduler.prototype.schedule=function schedule(action){action();return empty};ImmediateScheduler.prototype.scheduleWithState=function scheduleWithState(state,action){action(this,state);return empty};module.exports=ImmediateScheduler},{}],82:[function(require,module,exports){function TimeoutScheduler(delay){this.delay=delay}var TimerDisposable=function TimerDisposable(id){this.id=id;this.disposed=false};TimeoutScheduler.prototype.schedule=function schedule(action){var id=setTimeout(action,this.delay);return new TimerDisposable(id)};TimeoutScheduler.prototype.scheduleWithState=function scheduleWithState(state,action){var self=this;var id=setTimeout(function(){action(self,state)},this.delay);return new TimerDisposable(id)};TimerDisposable.prototype.dispose=function(){if(this.disposed){return}clearTimeout(this.id);this.disposed=true};module.exports=TimeoutScheduler},{}],83:[function(require,module,exports){var createHardlink=require("./../support/createHardlink");var $ref=require("./../types/ref");var isExpired=require("./../support/isAlreadyExpired");var isFunction=require("./../support/isFunction");var isPrimitive=require("./../support/isPrimitive");var expireNode=require("./../support/expireNode");var iterateKeySet=require("falcor-path-utils").iterateKeySet;var incrementVersion=require("./../support/incrementVersion");var mergeJSONGraphNode=require("./../support/mergeJSONGraphNode");var NullInPathError=require("./../errors/NullInPathError");module.exports=function setJSONGraphs(model,jsonGraphEnvelopes,x,errorSelector,comparator){var modelRoot=model._root;var lru=modelRoot;var expired=modelRoot.expired;var version=incrementVersion();var cache=modelRoot.cache;var initialVersion=cache.ツversion;var requestedPath=[];var optimizedPath=[];var requestedPaths=[];var optimizedPaths=[];var jsonGraphEnvelopeIndex=-1;var jsonGraphEnvelopeCount=jsonGraphEnvelopes.length;while(++jsonGraphEnvelopeIndex<jsonGraphEnvelopeCount){var jsonGraphEnvelope=jsonGraphEnvelopes[jsonGraphEnvelopeIndex];var paths=jsonGraphEnvelope.paths;var jsonGraph=jsonGraphEnvelope.jsonGraph;var pathIndex=-1;var pathCount=paths.length;while(++pathIndex<pathCount){var path=paths[pathIndex];optimizedPath.index=0;setJSONGraphPathSet(path,0,cache,cache,cache,jsonGraph,jsonGraph,jsonGraph,requestedPaths,optimizedPaths,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector)}}var newVersion=cache.ツversion;var rootChangeHandler=modelRoot.onChange;if(isFunction(rootChangeHandler)&&initialVersion!==newVersion){rootChangeHandler()}return[requestedPaths,optimizedPaths]};function setJSONGraphPathSet(path,depth,root,parent,node,messageRoot,messageParent,message,requestedPaths,optimizedPaths,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var note={};var branch=depth<path.length-1;var keySet=path[depth];var key=iterateKeySet(keySet,note);var optimizedIndex=optimizedPath.index;do{requestedPath.depth=depth;var results=setNode(root,parent,node,messageRoot,messageParent,message,key,branch,false,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);requestedPath[depth]=key;requestedPath.index=depth;optimizedPath[optimizedPath.index++]=key;var nextNode=results[0];var nextParent=results[1];if(nextNode){if(branch){setJSONGraphPathSet(path,depth+1,root,nextParent,nextNode,messageRoot,results[3],results[2],requestedPaths,optimizedPaths,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector)}else{requestedPaths.push(requestedPath.slice(0,requestedPath.index+1));optimizedPaths.push(optimizedPath.slice(0,optimizedPath.index))}}key=iterateKeySet(keySet,note);if(note.done){break}optimizedPath.index=optimizedIndex}while(true)}function setReference(root,node,messageRoot,message,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var reference=node.value;optimizedPath.splice(0,optimizedPath.length);optimizedPath.push.apply(optimizedPath,reference);if(isExpired(node)){optimizedPath.index=reference.length;expireNode(node,expired,lru);return[undefined,root,message,messageRoot]}var index=0;var container=node;var count=reference.length-1;var parent=node=root;var messageParent=message=messageRoot;do{var key=reference[index];var branch=index<count;optimizedPath.index=index;var results=setNode(root,parent,node,messageRoot,messageParent,message,key,branch,true,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);node=results[0];if(isPrimitive(node)){optimizedPath.index=index;return results}parent=results[1];message=results[2];messageParent=results[3]}while(index++<count);optimizedPath.index=index;if(container.ツcontext!==node){createHardlink(container,node)}return[node,parent,message,messageParent]}function setNode(root,parent,node,messageRoot,messageParent,message,key,branch,reference,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var type=node.$type;while(type===$ref){var results=setReference(root,node,messageRoot,message,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);node=results[0];if(isPrimitive(node)){return results}parent=results[1];message=results[2];messageParent=results[3];type=node.$type}if(type!==void 0){return[node,parent,message,messageParent]}if(key==null){if(branch){throw new NullInPathError}else if(node){key=node.ツkey}}else{parent=node;messageParent=message;node=parent[key];message=messageParent&&messageParent[key]}node=mergeJSONGraphNode(parent,node,message,key,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);return[node,parent,message,messageParent]}},{"./../errors/NullInPathError":31,"./../support/createHardlink":93,"./../support/expireNode":94,"./../support/incrementVersion":100,"./../support/isAlreadyExpired":102,"./../support/isFunction":104,"./../support/isPrimitive":110,"./../support/mergeJSONGraphNode":111,"./../types/ref":128,"falcor-path-utils":136}],84:[function(require,module,exports){var createHardlink=require("./../support/createHardlink");var __prefix=require("./../internal/unicodePrefix");var $ref=require("./../types/ref");var getBoundValue=require("./../get/getBoundValue");var isArray=Array.isArray;var hasOwn=require("./../support/hasOwn");var isObject=require("./../support/isObject");var isExpired=require("./../support/isExpired");var isFunction=require("./../support/isFunction");var isPrimitive=require("./../support/isPrimitive");var expireNode=require("./../support/expireNode");var incrementVersion=require("./../support/incrementVersion");var mergeValueOrInsertBranch=require("./../support/mergeValueOrInsertBranch");var NullInPathError=require("./../errors/NullInPathError");module.exports=function setPathMaps(model,pathMapEnvelopes,x,errorSelector,comparator){var modelRoot=model._root;var lru=modelRoot;var expired=modelRoot.expired;var version=incrementVersion();var bound=model._path;var cache=modelRoot.cache;var node=bound.length?getBoundValue(model,bound).value:cache;var parent=node.ツparent||cache;var initialVersion=cache.ツversion;var requestedPath=[];var requestedPaths=[];var optimizedPaths=[];var optimizedIndex=bound.length;var pathMapIndex=-1;var pathMapCount=pathMapEnvelopes.length;while(++pathMapIndex<pathMapCount){var pathMapEnvelope=pathMapEnvelopes[pathMapIndex];var optimizedPath=bound.slice(0);optimizedPath.index=optimizedIndex;setPathMap(pathMapEnvelope.json,0,cache,parent,node,requestedPaths,optimizedPaths,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector)}var newVersion=cache.ツversion;var rootChangeHandler=modelRoot.onChange;if(isFunction(rootChangeHandler)&&initialVersion!==newVersion){rootChangeHandler()}return[requestedPaths,optimizedPaths]};function setPathMap(pathMap,depth,root,parent,node,requestedPaths,optimizedPaths,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var keys=getKeys(pathMap);if(keys&&keys.length){var keyIndex=0;var keyCount=keys.length;var optimizedIndex=optimizedPath.index;do{var key=keys[keyIndex];var child=pathMap[key];var branch=isObject(child)&&!child.$type;requestedPath.depth=depth;var results=setNode(root,parent,node,key,child,branch,false,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);requestedPath[depth]=key;requestedPath.index=depth;optimizedPath[optimizedPath.index++]=key;var nextNode=results[0];var nextParent=results[1];if(nextNode){if(branch){setPathMap(child,depth+1,root,nextParent,nextNode,requestedPaths,optimizedPaths,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector)}else{requestedPaths.push(requestedPath.slice(0,requestedPath.index+1));optimizedPaths.push(optimizedPath.slice(0,optimizedPath.index))}}if(++keyIndex>=keyCount){break}optimizedPath.index=optimizedIndex}while(true)}}function setReference(value,root,node,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var reference=node.value;optimizedPath.splice(0,optimizedPath.length);optimizedPath.push.apply(optimizedPath,reference);if(isExpired(node)){optimizedPath.index=reference.length;expireNode(node,expired,lru);return[undefined,root]}var container=node;var parent=root;node=node.ツcontext;if(node!=null){parent=node.ツparent||root;optimizedPath.index=reference.length}else{var index=0;var count=reference.length-1;optimizedPath.index=index;parent=node=root;do{var key=reference[index];var branch=index<count;var results=setNode(root,parent,node,key,value,branch,true,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);node=results[0];if(isPrimitive(node)){optimizedPath.index=index;return results}parent=results[1]}while(index++<count);optimizedPath.index=index;if(container.ツcontext!==node){createHardlink(container,node)}}return[node,parent]}function setNode(root,parent,node,key,value,branch,reference,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var type=node.$type;while(type===$ref){var results=setReference(value,root,node,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);node=results[0];if(isPrimitive(node)){return results}parent=results[1];type=node&&node.$type}if(type!==void 0){return[node,parent]}if(key==null){if(branch){throw new NullInPathError}else if(node){key=node.ツkey}}else{parent=node;node=parent[key]}node=mergeValueOrInsertBranch(parent,node,key,value,branch,reference,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);return[node,parent]}function getKeys(pathMap){if(isObject(pathMap)&&!pathMap.$type){var keys=[];var itr=0;if(isArray(pathMap)){keys[itr++]="length"}for(var key in pathMap){if(key[0]===__prefix||key[0]==="$"||!hasOwn(pathMap,key)){continue}keys[itr++]=key}return keys}return void 0}},{"./../errors/NullInPathError":31,"./../get/getBoundValue":34,"./../internal/unicodePrefix":53,"./../support/createHardlink":93,"./../support/expireNode":94,"./../support/hasOwn":99,"./../support/incrementVersion":100,"./../support/isExpired":103,"./../support/isFunction":104,"./../support/isObject":108,"./../support/isPrimitive":110,"./../support/mergeValueOrInsertBranch":112,"./../types/ref":128}],85:[function(require,module,exports){var createHardlink=require("./../support/createHardlink");var $ref=require("./../types/ref");var getBoundValue=require("./../get/getBoundValue");var isExpired=require("./../support/isExpired");var isFunction=require("./../support/isFunction");var isPrimitive=require("./../support/isPrimitive");var expireNode=require("./../support/expireNode");var iterateKeySet=require("falcor-path-utils").iterateKeySet;var incrementVersion=require("./../support/incrementVersion");var mergeValueOrInsertBranch=require("./../support/mergeValueOrInsertBranch");var NullInPathError=require("./../errors/NullInPathError");module.exports=function setPathValues(model,pathValues,x,errorSelector,comparator){var modelRoot=model._root;var lru=modelRoot;var expired=modelRoot.expired;var version=incrementVersion();var bound=model._path;var cache=modelRoot.cache;var node=bound.length?getBoundValue(model,bound).value:cache;var parent=node.ツparent||cache;var initialVersion=cache.ツversion;var requestedPath=[];var requestedPaths=[];var optimizedPaths=[];var optimizedIndex=bound.length;var pathValueIndex=-1;var pathValueCount=pathValues.length;while(++pathValueIndex<pathValueCount){var pathValue=pathValues[pathValueIndex];var path=pathValue.path;var value=pathValue.value;var optimizedPath=bound.slice(0);optimizedPath.index=optimizedIndex;setPathSet(value,path,0,cache,parent,node,requestedPaths,optimizedPaths,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector)}var newVersion=cache.ツversion;var rootChangeHandler=modelRoot.onChange;if(isFunction(rootChangeHandler)&&initialVersion!==newVersion){rootChangeHandler()}return[requestedPaths,optimizedPaths]};function setPathSet(value,path,depth,root,parent,node,requestedPaths,optimizedPaths,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var note={};var branch=depth<path.length-1;var keySet=path[depth];var key=iterateKeySet(keySet,note);var optimizedIndex=optimizedPath.index;do{requestedPath.depth=depth;var results=setNode(root,parent,node,key,value,branch,false,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);requestedPath[depth]=key;requestedPath.index=depth;optimizedPath[optimizedPath.index++]=key;var nextNode=results[0];var nextParent=results[1];if(nextNode){if(branch){setPathSet(value,path,depth+1,root,nextParent,nextNode,requestedPaths,optimizedPaths,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector)}else{requestedPaths.push(requestedPath.slice(0,requestedPath.index+1));optimizedPaths.push(optimizedPath.slice(0,optimizedPath.index))}}key=iterateKeySet(keySet,note);if(note.done){break}optimizedPath.index=optimizedIndex}while(true)}function setReference(value,root,node,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var reference=node.value;optimizedPath.splice(0,optimizedPath.length);optimizedPath.push.apply(optimizedPath,reference);if(isExpired(node)){optimizedPath.index=reference.length;expireNode(node,expired,lru);return[undefined,root]}var container=node;var parent=root;node=node.ツcontext;if(node!=null){parent=node.ツparent||root;optimizedPath.index=reference.length}else{var index=0;var count=reference.length-1;parent=node=root;do{var key=reference[index];var branch=index<count;optimizedPath.index=index;var results=setNode(root,parent,node,key,value,branch,true,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);node=results[0];if(isPrimitive(node)){optimizedPath.index=index;return results}parent=results[1]}while(index++<count);optimizedPath.index=index;if(container.ツcontext!==node){createHardlink(container,node)}}return[node,parent]}function setNode(root,parent,node,key,value,branch,reference,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var type=node.$type;while(type===$ref){var results=setReference(value,root,node,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);node=results[0];if(isPrimitive(node)){return results}parent=results[1];type=node.$type}if(type!==void 0){return[node,parent]}if(key==null){if(branch){throw new NullInPathError}else if(node){key=node.ツkey}}else{parent=node;node=parent[key]}node=mergeValueOrInsertBranch(parent,node,key,value,branch,reference,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);return[node,parent]}},{"./../errors/NullInPathError":31,"./../get/getBoundValue":34,"./../support/createHardlink":93,"./../support/expireNode":94,"./../support/incrementVersion":100,"./../support/isExpired":103,"./../support/isFunction":104,"./../support/isPrimitive":110,"./../support/mergeValueOrInsertBranch":112,"./../types/ref":128,"falcor-path-utils":136}],86:[function(require,module,exports){var jsong=require("falcor-json-graph");var ModelResponse=require("./../response/ModelResponse");var isPathValue=require("./../support/isPathValue");module.exports=function setValue(pathArg,valueArg){var value=isPathValue(pathArg)?pathArg:jsong.pathValue(pathArg,valueArg);var pathIdx=0;var path=value.path;var pathLen=path.length;while(++pathIdx<pathLen){if(typeof path[pathIdx]==="object"){return new ModelResponse(function(o){o.onError(new Error("Paths must be simple paths"))})}}var self=this;return new ModelResponse(function(obs){return self.set(value).subscribe(function(data){var curr=data.json;var depth=-1;var length=path.length;while(curr&&++depth<length){curr=curr[path[depth]]}obs.onNext(curr)},function(err){obs.onError(err)},function(){obs.onCompleted()})})}},{"./../response/ModelResponse":68,"./../support/isPathValue":109,"falcor-json-graph":133}],87:[function(require,module,exports){var pathSyntax=require("falcor-path-syntax");var isPathValue=require("./../support/isPathValue");var setPathValues=require("./../set/setPathValues");module.exports=function setValueSync(pathArg,valueArg,errorSelectorArg,comparatorArg){var path=pathSyntax.fromPath(pathArg);var value=valueArg;var errorSelector=errorSelectorArg;var comparator=comparatorArg;if(isPathValue(path)){comparator=errorSelector;errorSelector=value;value=path}else{value={path:path,value:value}}if(isPathValue(value)===false){throw new Error("Model#setValueSync must be called with an Array path.")}if(typeof errorSelector!=="function"){errorSelector=this._root._errorSelector}if(typeof comparator!=="function"){comparator=this._root._comparator}if(this._syncCheck("setValueSync")){setPathValues(this,[value]);return this._getValueSync(this,value.path).value}}},{"./../set/setPathValues":85,"./../support/isPathValue":109,"falcor-path-syntax":11}],88:[function(require,module,exports){module.exports=function arrayClone(array){if(!array){return array}var i=-1;var n=array.length;var array2=[];while(++i<n){array2[i]=array[i]}return array2}},{}],89:[function(require,module,exports){module.exports=function arrayFlatMap(array,selector){var index=-1;var i=-1;var n=array.length;var array2=[];while(++i<n){var array3=selector(array[i],i,array);var j=-1;var k=array3.length;while(++j<k){array2[++index]=array3[j]}}return array2}},{}],90:[function(require,module,exports){module.exports=function arrayMap(array,selector){var i=-1;var n=array.length;var array2=new Array(n);while(++i<n){array2[i]=selector(array[i],i,array)}return array2}},{}],91:[function(require,module,exports){module.exports=function arraySlice(array,indexArg,endArg){var index=indexArg||0;var i=-1;var n=array.length-index;if(n<0){n=0}if(endArg>0&&n>endArg){n=endArg}var array2=new Array(n);while(++i<n){array2[i]=array[i+index]}return array2}},{}],92:[function(require,module,exports){var unicodePrefix=require("./../internal/unicodePrefix");var hasOwn=require("./../support/hasOwn");var isArray=Array.isArray;var isObject=require("./../support/isObject");module.exports=function clone(value){var dest=value;if(isObject(dest)){dest=isArray(value)?[]:{};var src=value;for(var key in src){if(key.charAt(0)===unicodePrefix||!hasOwn(src,key)){continue}dest[key]=src[key]}}return dest}},{"./../internal/unicodePrefix":53,"./../support/hasOwn":99,"./../support/isObject":108}],93:[function(require,module,exports){var __ref=require("./../internal/ref");module.exports=function createHardlink(from,to){var backRefs=to.ツrefsLength||0;to[__ref+backRefs]=from;to.ツrefsLength=backRefs+1;from.ツrefIndex=backRefs;from.ツcontext=to}},{"./../internal/ref":52}],94:[function(require,module,exports){var splice=require("./../lru/splice");module.exports=function expireNode(node,expired,lru){if(!node.ツinvalidated){node.ツinvalidated=true;expired.push(node);splice(lru,node)}return node}},{"./../lru/splice":58}],95:[function(require,module,exports){var isObject=require("./isObject");module.exports=function getSize(node){return isObject(node)&&node.$expires||undefined}},{"./isObject":108}],96:[function(require,module,exports){var isObject=require("./../support/isObject");module.exports=function getSize(node){return isObject(node)&&node.$size||0}},{"./../support/isObject":108}],97:[function(require,module,exports){var isObject=require("./../support/isObject");module.exports=function getTimestamp(node){return isObject(node)&&node.$timestamp||undefined}},{"./../support/isObject":108}],98:[function(require,module,exports){var isObject=require("./../support/isObject");module.exports=function getType(node,anyType){var type=isObject(node)&&node.$type||void 0;if(anyType&&type){return"branch"}return type}},{"./../support/isObject":108}],99:[function(require,module,exports){var isObject=require("./isObject");var hasOwn=Object.prototype.hasOwnProperty;module.exports=function(obj,prop){return isObject(obj)&&hasOwn.call(obj,prop)}},{"./isObject":108}],100:[function(require,module,exports){var version=1;module.exports=function incrementVersion(){return version++}},{}],101:[function(require,module,exports){module.exports=function insertNode(node,parent,key,version,optimizedPath){node.ツkey=key;node.ツparent=parent;if(version!==undefined){node.ツversion=version}if(!node.ツabsolutePath){node.ツabsolutePath=optimizedPath.slice(0,optimizedPath.index).concat(key)}parent[key]=node;return node}},{}],102:[function(require,module,exports){var now=require("./../support/now");var $now=require("./../values/expires-now");var $never=require("./../values/expires-never");module.exports=function isAlreadyExpired(node){var exp=node.$expires;return exp!=null&&exp!==$never&&exp!==$now&&exp<now()}},{"./../support/now":114,"./../values/expires-never":129,"./../values/expires-now":130}],103:[function(require,module,exports){var now=require("./../support/now");var $now=require("../values/expires-now");var $never=require("../values/expires-never");module.exports=function isExpired(node){var exp=node.$expires;return exp!=null&&exp!==$never&&(exp===$now||exp<now())}},{"../values/expires-never":129,"../values/expires-now":130,"./../support/now":114}],104:[function(require,module,exports){var functionTypeof="function";module.exports=function isFunction(func){return Boolean(func)&&typeof func===functionTypeof}},{}],105:[function(require,module,exports){var unicodePrefix=require("./../internal/unicodePrefix");module.exports=function isInternalKey(x){return x==="$size"||x==="$modelCreated"||x.charAt(0)===unicodePrefix}},{"./../internal/unicodePrefix":53}],106:[function(require,module,exports){var isObject=require("./../support/isObject");module.exports=function isJSONEnvelope(envelope){return isObject(envelope)&&"json"in envelope}},{"./../support/isObject":108}],107:[function(require,module,exports){var isArray=Array.isArray;var isObject=require("./../support/isObject");module.exports=function isJSONGraphEnvelope(envelope){return isObject(envelope)&&isArray(envelope.paths)&&(isObject(envelope.jsonGraph)||isObject(envelope.jsong)||isObject(envelope.json)||isObject(envelope.values)||isObject(envelope.value))}},{"./../support/isObject":108}],108:[function(require,module,exports){var objTypeof="object";module.exports=function isObject(value){return value!==null&&typeof value===objTypeof}},{}],109:[function(require,module,exports){var isArray=Array.isArray;var isObject=require("./../support/isObject");module.exports=function isPathValue(pathValue){return isObject(pathValue)&&(isArray(pathValue.path)||typeof pathValue.path==="string")}},{"./../support/isObject":108}],110:[function(require,module,exports){var objTypeof="object";module.exports=function isPrimitive(value){return value==null||typeof value!==objTypeof}},{}],111:[function(require,module,exports){var $ref=require("./../types/ref");var $error=require("./../types/error");var getSize=require("./../support/getSize");var getTimestamp=require("./../support/getTimestamp");var isObject=require("./../support/isObject");var isExpired=require("./../support/isExpired");var isFunction=require("./../support/isFunction");var wrapNode=require("./../support/wrapNode");var insertNode=require("./../support/insertNode");var expireNode=require("./../support/expireNode");var replaceNode=require("./../support/replaceNode");var updateNodeAncestors=require("./../support/updateNodeAncestors");var reconstructPath=require("./../support/reconstructPath");module.exports=function mergeJSONGraphNode(parent,node,message,key,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var sizeOffset;var cType,mType,cIsObject,mIsObject,cTimestamp,mTimestamp;if(node===message){if(message===null){node=wrapNode(message,undefined,message);parent=updateNodeAncestors(parent,-node.$size,lru,version);node=insertNode(node,parent,key,undefined,optimizedPath);return node}else if(message===undefined){return message}else{cIsObject=isObject(node);if(cIsObject){cType=node.$type;if(cType==null){if(node.ツparent==null){insertNode(node,parent,key,version,optimizedPath)}return node}}}}else{cIsObject=isObject(node);if(cIsObject){cType=node.$type}}if(cType!==$ref){mIsObject=isObject(message);if(mIsObject){mType=message.$type}if(cIsObject&&!cType){if(message==null||mIsObject&&!mType){return node}}}else{if(message==null){if(isExpired(node)){expireNode(node,expired,lru);return void 0}return node}mIsObject=isObject(message);if(mIsObject){mType=message.$type;if(mType===$ref){if(node===message){if(node.ツparent!=null){return node}}else{cTimestamp=node.$timestamp;mTimestamp=message.$timestamp;if(!isExpired(node)&&!isExpired(message)&&mTimestamp<cTimestamp){return void 0}}}}}if(cType&&mIsObject&&!mType){return insertNode(replaceNode(node,message,parent,key,lru),parent,key,undefined,optimizedPath)}else if(mType||!mIsObject){if(mType===$error&&isFunction(errorSelector)){message=errorSelector(reconstructPath(requestedPath,key),message)}if(mType&&node===message){if(node.ツparent==null){node=wrapNode(node,cType,node.value);parent=updateNodeAncestors(parent,-node.$size,lru,version);node=insertNode(node,parent,key,version,optimizedPath)}}else{var isDistinct=true;if(cType||!cIsObject){isDistinct=getTimestamp(message)<getTimestamp(node)===false;if((cType||mType)&&isFunction(comparator)){isDistinct=!comparator(node,message,optimizedPath.slice(0,optimizedPath.index))}}if(isDistinct){message=wrapNode(message,mType,mType?message.value:message);sizeOffset=getSize(node)-getSize(message);node=replaceNode(node,message,parent,key,lru);parent=updateNodeAncestors(parent,sizeOffset,lru,version);node=insertNode(node,parent,key,version,optimizedPath)}}if(isExpired(node)){expireNode(node,expired,lru)}}else if(node==null){node=insertNode(message,parent,key,undefined,optimizedPath)}return node}},{"./../support/expireNode":94,"./../support/getSize":96,"./../support/getTimestamp":97,"./../support/insertNode":101,"./../support/isExpired":103,"./../support/isFunction":104,"./../support/isObject":108,"./../support/reconstructPath":115,"./../support/replaceNode":118,"./../support/updateNodeAncestors":123,"./../support/wrapNode":125,"./../types/error":127,"./../types/ref":128}],112:[function(require,module,exports){var $ref=require("./../types/ref");var $error=require("./../types/error");var getType=require("./../support/getType");var getSize=require("./../support/getSize");var getTimestamp=require("./../support/getTimestamp");var isExpired=require("./../support/isExpired");var isPrimitive=require("./../support/isPrimitive");var isFunction=require("./../support/isFunction");var wrapNode=require("./../support/wrapNode");var expireNode=require("./../support/expireNode");var insertNode=require("./../support/insertNode");var replaceNode=require("./../support/replaceNode");var updateNodeAncestors=require("./../support/updateNodeAncestors");var updateBackReferenceVersions=require("./../support/updateBackReferenceVersions");var reconstructPath=require("./../support/reconstructPath");module.exports=function mergeValueOrInsertBranch(parent,node,key,value,branch,reference,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var type=getType(node,reference);if(branch||reference){if(type&&isExpired(node)){type="expired";expireNode(node,expired,lru)}if(type&&type!==$ref||isPrimitive(node)){node=replaceNode(node,{},parent,key,lru);node=insertNode(node,parent,key,version,optimizedPath);node=updateBackReferenceVersions(node,version)}}else{var message=value;var mType=getType(message);var isDistinct=getTimestamp(message)<getTimestamp(node)===false;if((type||mType)&&isFunction(comparator)){isDistinct=!comparator(node,message,optimizedPath.slice(0,optimizedPath.index))}if(isDistinct){if(mType===$error&&isFunction(errorSelector)){message=errorSelector(reconstructPath(requestedPath,key),message)}message=wrapNode(message,mType,mType?message.value:message);var sizeOffset=getSize(node)-getSize(message);node=replaceNode(node,message,parent,key,lru);parent=updateNodeAncestors(parent,sizeOffset,lru,version);node=insertNode(node,parent,key,version,optimizedPath)}}return node}},{"./../support/expireNode":94,"./../support/getSize":96,"./../support/getTimestamp":97,"./../support/getType":98,"./../support/insertNode":101,"./../support/isExpired":103,"./../support/isFunction":104,"./../support/isPrimitive":110,"./../support/reconstructPath":115,"./../support/replaceNode":118,"./../support/updateBackReferenceVersions":122,"./../support/updateNodeAncestors":123,"./../support/wrapNode":125,"./../types/error":127,"./../types/ref":128}],113:[function(require,module,exports){module.exports=function noop(){}},{}],114:[function(require,module,exports){module.exports=Date.now},{}],115:[function(require,module,exports){module.exports=function reconstructPath(currentPath,key){var path=currentPath.slice(0,currentPath.depth);path[path.length]=key;return path}},{}],116:[function(require,module,exports){var $ref=require("./../types/ref");var splice=require("./../lru/splice");var isObject=require("./../support/isObject");var unlinkBackReferences=require("./../support/unlinkBackReferences");var unlinkForwardReference=require("./../support/unlinkForwardReference");module.exports=function removeNode(node,parent,key,lru){if(isObject(node)){var type=node.$type;if(Boolean(type)){if(type===$ref){unlinkForwardReference(node)}splice(lru,node)}unlinkBackReferences(node);parent[key]=node.ツparent=void 0;return true}return false}},{"./../lru/splice":58,"./../support/isObject":108,"./../support/unlinkBackReferences":120,"./../support/unlinkForwardReference":121,"./../types/ref":128}],117:[function(require,module,exports){var hasOwn=require("./../support/hasOwn");var prefix=require("./../internal/unicodePrefix");var removeNode=require("./../support/removeNode");module.exports=function removeNodeAndDescendants(node,parent,key,lru){if(removeNode(node,parent,key,lru)){
if(node.$type==null){for(var key2 in node){if(key2[0]!==prefix&&key2[0]!=="$"&&hasOwn(node,key2)){removeNodeAndDescendants(node[key2],node,key2,lru)}}}return true}return false}},{"./../internal/unicodePrefix":53,"./../support/hasOwn":99,"./../support/removeNode":116}],118:[function(require,module,exports){var isObject=require("./../support/isObject");var transferBackReferences=require("./../support/transferBackReferences");var removeNodeAndDescendants=require("./../support/removeNodeAndDescendants");module.exports=function replaceNode(node,replacement,parent,key,lru){if(node===replacement){return node}else if(isObject(node)){transferBackReferences(node,replacement);removeNodeAndDescendants(node,parent,key,lru)}parent[key]=replacement;return replacement}},{"./../support/isObject":108,"./../support/removeNodeAndDescendants":117,"./../support/transferBackReferences":119}],119:[function(require,module,exports){var __ref=require("./../internal/ref");module.exports=function transferBackReferences(fromNode,destNode){var fromNodeRefsLength=fromNode.ツrefsLength||0,destNodeRefsLength=destNode.ツrefsLength||0,i=-1;while(++i<fromNodeRefsLength){var ref=fromNode[__ref+i];if(ref!==void 0){ref.ツcontext=destNode;destNode[__ref+(destNodeRefsLength+i)]=ref;fromNode[__ref+i]=void 0}}destNode.ツrefsLength=fromNodeRefsLength+destNodeRefsLength;fromNode.ツrefsLength=void 0;return destNode}},{"./../internal/ref":52}],120:[function(require,module,exports){var __ref=require("./../internal/ref");module.exports=function unlinkBackReferences(node){var i=-1,n=node.ツrefsLength||0;while(++i<n){var ref=node[__ref+i];if(ref!=null){ref.ツcontext=ref.ツrefIndex=node[__ref+i]=void 0}}node.ツrefsLength=void 0;return node}},{"./../internal/ref":52}],121:[function(require,module,exports){var __ref=require("./../internal/ref");module.exports=function unlinkForwardReference(reference){var destination=reference.ツcontext;if(destination){var i=(reference.ツrefIndex||0)-1,n=(destination.ツrefsLength||0)-1;while(++i<=n){destination[__ref+i]=destination[__ref+(i+1)]}destination.ツrefsLength=n;reference.ツrefIndex=reference.ツcontext=destination=void 0}return reference}},{"./../internal/ref":52}],122:[function(require,module,exports){var __ref=require("./../internal/ref");module.exports=function updateBackReferenceVersions(nodeArg,version){var stack=[nodeArg];var count=0;do{var node=stack[count];if(node&&node.ツversion!==version){node.ツversion=version;stack[count++]=node.ツparent;var i=-1;var n=node.ツrefsLength||0;while(++i<n){stack[count++]=node[__ref+i]}}}while(--count>-1);return nodeArg}},{"./../internal/ref":52}],123:[function(require,module,exports){var removeNode=require("./../support/removeNode");var updateBackReferenceVersions=require("./../support/updateBackReferenceVersions");module.exports=function updateNodeAncestors(nodeArg,offset,lru,version){var child=nodeArg;do{var node=child.ツparent;var size=child.$size=(child.$size||0)-offset;if(size<=0&&node!=null){removeNode(child,node,child.ツkey,lru)}else if(child.ツversion!==version){updateBackReferenceVersions(child,version)}child=node}while(child);return nodeArg}},{"./../support/removeNode":116,"./../support/updateBackReferenceVersions":122}],124:[function(require,module,exports){var isArray=Array.isArray;var isPathValue=require("./../support/isPathValue");var isJSONGraphEnvelope=require("./../support/isJSONGraphEnvelope");var isJSONEnvelope=require("./../support/isJSONEnvelope");var pathSyntax=require("falcor-path-syntax");module.exports=function validateInput(args,allowedInput,method){for(var i=0,len=args.length;i<len;++i){var arg=args[i];var valid=false;if(isArray(arg)&&allowedInput.path){valid=true}else if(typeof arg==="string"&&allowedInput.pathSyntax){valid=true}else if(isPathValue(arg)&&allowedInput.pathValue){arg.path=pathSyntax.fromPath(arg.path);valid=true}else if(isJSONGraphEnvelope(arg)&&allowedInput.jsonGraph){valid=true}else if(isJSONEnvelope(arg)&&allowedInput.json){valid=true}else if(typeof arg==="function"&&i+1===len&&allowedInput.selector){valid=true}if(!valid){return new Error("Unrecognized argument "+typeof arg+" ["+String(arg)+"] "+"to Model#"+method+"")}}return true}},{"./../support/isJSONEnvelope":106,"./../support/isJSONGraphEnvelope":107,"./../support/isPathValue":109,"falcor-path-syntax":11}],125:[function(require,module,exports){var now=require("./../support/now");var expiresNow=require("../values/expires-now");var atomSize=50;var clone=require("./../support/clone");var isArray=Array.isArray;var getSize=require("./../support/getSize");var getExpires=require("./../support/getExpires");var atomType=require("./../types/atom");module.exports=function wrapNode(nodeArg,typeArg,value){var size=0;var node=nodeArg;var type=typeArg;if(type){var modelCreated=node.ツmodelCreated;node=clone(node);size=getSize(node);node.$type=type;node.ツprev=undefined;node.ツnext=undefined;node.ツmodelCreated=modelCreated||false}else{node={$type:atomType,value:value,"ツprev":undefined,"ツnext":undefined,"ツmodelCreated":true}}if(value==null){size=atomSize+1}else if(size==null||size<=0){switch(typeof value){case"object":if(isArray(value)){size=atomSize+value.length}else{size=atomSize+1}break;case"string":size=atomSize+value.length;break;default:size=atomSize+1;break}}var expires=getExpires(node);if(typeof expires==="number"&&expires<expiresNow){node.$expires=now()+expires*-1}node.$size=size;return node}},{"../values/expires-now":130,"./../support/clone":92,"./../support/getExpires":95,"./../support/getSize":96,"./../support/now":114,"./../types/atom":126}],126:[function(require,module,exports){module.exports="atom"},{}],127:[function(require,module,exports){module.exports="error"},{}],128:[function(require,module,exports){module.exports="ref"},{}],129:[function(require,module,exports){module.exports=1},{}],130:[function(require,module,exports){module.exports=0},{}],131:[function(require,module,exports){"use strict";var rawAsap=require("./raw");var freeTasks=[];var pendingErrors=[];var requestErrorThrow=rawAsap.makeRequestCallFromTimer(throwFirstError);function throwFirstError(){if(pendingErrors.length){throw pendingErrors.shift()}}module.exports=asap;function asap(task){var rawTask;if(freeTasks.length){rawTask=freeTasks.pop()}else{rawTask=new RawTask}rawTask.task=task;rawAsap(rawTask)}function RawTask(){this.task=null}RawTask.prototype.call=function(){try{this.task.call()}catch(error){if(asap.onerror){asap.onerror(error)}else{pendingErrors.push(error);requestErrorThrow()}}finally{this.task=null;freeTasks[freeTasks.length]=this}}},{"./raw":132}],132:[function(require,module,exports){(function(global){"use strict";module.exports=rawAsap;function rawAsap(task){if(!queue.length){requestFlush();flushing=true}queue[queue.length]=task}var queue=[];var flushing=false;var requestFlush;var index=0;var capacity=1024;function flush(){while(index<queue.length){var currentIndex=index;index=index+1;queue[currentIndex].call();if(index>capacity){for(var scan=0,newLength=queue.length-index;scan<newLength;scan++){queue[scan]=queue[scan+index]}queue.length-=index;index=0}}queue.length=0;index=0;flushing=false}var BrowserMutationObserver=global.MutationObserver||global.WebKitMutationObserver;if(typeof BrowserMutationObserver==="function"){requestFlush=makeRequestCallFromMutationObserver(flush)}else{requestFlush=makeRequestCallFromTimer(flush)}rawAsap.requestFlush=requestFlush;function makeRequestCallFromMutationObserver(callback){var toggle=1;var observer=new BrowserMutationObserver(callback);var node=document.createTextNode("");observer.observe(node,{characterData:true});return function requestCall(){toggle=-toggle;node.data=toggle}}function makeRequestCallFromTimer(callback){return function requestCall(){var timeoutHandle=setTimeout(handleTimer,0);var intervalHandle=setInterval(handleTimer,50);function handleTimer(){clearTimeout(timeoutHandle);clearInterval(intervalHandle);callback()}}}rawAsap.makeRequestCallFromTimer=makeRequestCallFromTimer}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],133:[function(require,module,exports){var pathSyntax=require("falcor-path-syntax");function sentinel(type,value,props){var copy=Object.create(null);if(props!=null){for(var key in props){copy[key]=props[key]}copy["$type"]=type;copy.value=value;return copy}else{return{$type:type,value:value}}}module.exports={ref:function ref(path,props){return sentinel("ref",pathSyntax.fromPath(path),props)},atom:function atom(value,props){return sentinel("atom",value,props)},undefined:function(){return sentinel("atom")},error:function error(errorValue,props){return sentinel("error",errorValue,props)},pathValue:function pathValue(path,value){return{path:pathSyntax.fromPath(path),value:value}},pathInvalidation:function pathInvalidation(path){return{path:pathSyntax.fromPath(path),invalidated:true}}}},{"falcor-path-syntax":11}],134:[function(require,module,exports){var toPaths=require("./toPaths");var toTree=require("./toTree");module.exports=function collapse(paths){var collapseMap=paths.reduce(function(acc,path){var len=path.length;if(!acc[len]){acc[len]=[]}acc[len].push(path);return acc},{});Object.keys(collapseMap).forEach(function(collapseKey){collapseMap[collapseKey]=toTree(collapseMap[collapseKey])});return toPaths(collapseMap)}},{"./toPaths":140,"./toTree":141}],135:[function(require,module,exports){var iterateKeySet=require("./iterateKeySet");module.exports=function hasIntersection(tree,path,depth){var current=tree;var intersects=true;for(;intersects&&depth<path.length;++depth){var key=path[depth];var keyType=typeof key;if(key&&keyType==="object"){var note={};var innerKey=iterateKeySet(key,note);var nextDepth=depth+1;do{var next=current[innerKey];intersects=next!==undefined;if(intersects){intersects=hasIntersection(next,path,nextDepth)}innerKey=iterateKeySet(key,note)}while(intersects&&!note.done);break}current=current[key];intersects=current!==undefined}return intersects}},{"./iterateKeySet":137}],136:[function(require,module,exports){module.exports={iterateKeySet:require("./iterateKeySet"),toTree:require("./toTree"),toTreeWithUnion:require("./toTreeWithUnion"),pathsComplementFromTree:require("./pathsComplementFromTree"),pathsComplementFromLengthTree:require("./pathsComplementFromLengthTree"),hasIntersection:require("./hasIntersection"),toPaths:require("./toPaths"),collapse:require("./collapse")}},{"./collapse":134,"./hasIntersection":135,"./iterateKeySet":137,"./pathsComplementFromLengthTree":138,"./pathsComplementFromTree":139,"./toPaths":140,"./toTree":141,"./toTreeWithUnion":142}],137:[function(require,module,exports){var isArray=Array.isArray;module.exports=function iterateKeySet(keySet,note){if(note.isArray===undefined){initializeNote(keySet,note)}if(note.isArray){var nextValue;do{if(note.loaded&&note.rangeOffset>note.to){++note.arrayOffset;note.loaded=false}var idx=note.arrayOffset,length=keySet.length;if(idx>=length){note.done=true;break}var el=keySet[note.arrayOffset];var type=typeof el;if(type==="object"){if(!note.loaded){initializeRange(el,note)}if(note.empty){continue}nextValue=note.rangeOffset++}else{++note.arrayOffset;nextValue=el}}while(nextValue===undefined);return nextValue}else if(note.isObject){if(!note.loaded){initializeRange(keySet,note)}if(note.rangeOffset>note.to){note.done=true;return undefined}return note.rangeOffset++}else{note.done=true;return keySet}};function initializeRange(key,memo){var from=memo.from=key.from||0;var to=memo.to=key.to||(typeof key.length==="number"&&memo.from+key.length-1||0);memo.rangeOffset=memo.from;memo.loaded=true;if(from>to){memo.empty=true}}function initializeNote(key,note){note.done=false;var isObject=note.isObject=!!(key&&typeof key==="object");note.isArray=isObject&&isArray(key);note.arrayOffset=0}},{}],138:[function(require,module,exports){var hasIntersection=require("./hasIntersection");module.exports=function pathsComplementFromLengthTree(paths,tree){var out=[];var outLength=-1;for(var i=0,len=paths.length;i<len;++i){var path=paths[i];if(!hasIntersection(tree[path.length],path,0)){out[++outLength]=path}}return out}},{"./hasIntersection":135}],139:[function(require,module,exports){var hasIntersection=require("./hasIntersection");module.exports=function pathsComplementFromTree(paths,tree){var out=[];var outLength=-1;for(var i=0,len=paths.length;i<len;++i){if(!hasIntersection(tree,paths[i],0)){out[++outLength]=paths[i]}}return out}},{"./hasIntersection":135}],140:[function(require,module,exports){var isArray=Array.isArray;var typeOfObject="object";module.exports=function toPaths(lengths){var pathmap;var allPaths=[];var allPathsLength=0;for(var length in lengths){if(isNumber(length)&&isObject(pathmap=lengths[length])){var paths=collapsePathMap(pathmap,0,parseInt(length,10)).sets;var pathsIndex=-1;var pathsCount=paths.length;while(++pathsIndex<pathsCount){allPaths[allPathsLength++]=collapsePathSetIndexes(paths[pathsIndex])}}}return allPaths};function isObject(value){return value!==null&&typeof value===typeOfObject}function collapsePathMap(pathmap,depth,length){var key;var code=getHashCode(String(depth));var subs=Object.create(null);var codes=[];var codesIndex=-1;var codesCount=0;var pathsets=[];var pathsetsCount=0;var subPath,subCode,subKeys,subKeysIndex,subKeysCount,subSets,subSetsIndex,subSetsCount,pathset,pathsetIndex,pathsetCount,firstSubKey,pathsetClone;subKeys=[];subKeysIndex=-1;if(depth<length-1){subKeysCount=getSortedKeys(pathmap,subKeys);while(++subKeysIndex<subKeysCount){key=subKeys[subKeysIndex];subPath=collapsePathMap(pathmap[key],depth+1,length);subCode=subPath.code;if(subs[subCode]){subPath=subs[subCode]}else{codes[codesCount++]=subCode;subPath=subs[subCode]={keys:[],sets:subPath.sets}}code=getHashCode(code+key+subCode);isNumber(key)&&subPath.keys.push(parseInt(key,10))||subPath.keys.push(key)}while(++codesIndex<codesCount){key=codes[codesIndex];subPath=subs[key];subKeys=subPath.keys;subKeysCount=subKeys.length;if(subKeysCount>0){subSets=subPath.sets;subSetsIndex=-1;subSetsCount=subSets.length;firstSubKey=subKeys[0];while(++subSetsIndex<subSetsCount){pathset=subSets[subSetsIndex];pathsetIndex=-1;pathsetCount=pathset.length;pathsetClone=new Array(pathsetCount+1);pathsetClone[0]=subKeysCount>1&&subKeys||firstSubKey;while(++pathsetIndex<pathsetCount){pathsetClone[pathsetIndex+1]=pathset[pathsetIndex]}pathsets[pathsetsCount++]=pathsetClone}}}}else{subKeysCount=getSortedKeys(pathmap,subKeys);if(subKeysCount>1){pathsets[pathsetsCount++]=[subKeys]}else{pathsets[pathsetsCount++]=subKeys}while(++subKeysIndex<subKeysCount){code=getHashCode(code+subKeys[subKeysIndex])}}return{code:code,sets:pathsets}}function collapsePathSetIndexes(pathset){var keysetIndex=-1;var keysetCount=pathset.length;while(++keysetIndex<keysetCount){var keyset=pathset[keysetIndex];if(isArray(keyset)){pathset[keysetIndex]=collapseIndex(keyset)}}return pathset}function collapseIndex(keyset){var keyIndex=-1;var keyCount=keyset.length-1;var isSparseRange=keyCount>0;while(++keyIndex<=keyCount){var key=keyset[keyIndex];if(!isNumber(key)){isSparseRange=false;break}keyset[keyIndex]=parseInt(key,10)}if(isSparseRange===true){keyset.sort(sortListAscending);var from=keyset[0];var to=keyset[keyCount];if(to-from<=keyCount){return{from:from,to:to}}}return keyset}function sortListAscending(a,b){return a-b}function getSortedKeys(map,keys,sort){var len=0;for(var key in map){keys[len++]=key}if(len>1){keys.sort(sort)}return len}function getHashCode(key){var code=5381;var index=-1;var count=key.length;while(++index<count){code=(code<<5)+code+key.charCodeAt(index)}return String(code)}function isNumber(val){return!isArray(val)&&val-parseFloat(val)+1>=0}},{}],141:[function(require,module,exports){var iterateKeySet=require("./../lib/iterateKeySet");var isArray=Array.isArray;module.exports=function toTree(paths){return paths.reduce(function(acc,path){innerToTree(acc,path,0);return acc},{})};function innerToTree(seed,path,depth){var keySet=path[depth];var iteratorNote={};var key;var nextDepth=depth+1;key=iterateKeySet(keySet,iteratorNote);do{var next=seed[key];if(!next){if(nextDepth===path.length){seed[key]=null}else{next=seed[key]={}}}if(nextDepth<path.length){innerToTree(next,path,nextDepth)}if(!iteratorNote.done){key=iterateKeySet(keySet,iteratorNote)}}while(!iteratorNote.done)}},{"./../lib/iterateKeySet":137}],142:[function(require,module,exports){},{}],143:[function(require,module,exports){"use strict";module.exports=require("./lib")},{"./lib":148}],144:[function(require,module,exports){"use strict";var asap=require("asap/raw");function noop(){}var LAST_ERROR=null;var IS_ERROR={};function getThen(obj){try{return obj.then}catch(ex){LAST_ERROR=ex;return IS_ERROR}}function tryCallOne(fn,a){try{return fn(a)}catch(ex){LAST_ERROR=ex;return IS_ERROR}}function tryCallTwo(fn,a,b){try{fn(a,b)}catch(ex){LAST_ERROR=ex;return IS_ERROR}}module.exports=Promise;function Promise(fn){if(typeof this!=="object"){throw new TypeError("Promises must be constructed via new")}if(typeof fn!=="function"){throw new TypeError("not a function")}this._37=0;this._12=null;this._59=[];if(fn===noop)return;doResolve(fn,this)}Promise._99=noop;Promise.prototype.then=function(onFulfilled,onRejected){if(this.constructor!==Promise){return safeThen(this,onFulfilled,onRejected)}var res=new Promise(noop);handle(this,new Handler(onFulfilled,onRejected,res));return res};function safeThen(self,onFulfilled,onRejected){return new self.constructor(function(resolve,reject){var res=new Promise(noop);res.then(resolve,reject);handle(self,new Handler(onFulfilled,onRejected,res))})}function handle(self,deferred){while(self._37===3){self=self._12}if(self._37===0){self._59.push(deferred);return}asap(function(){var cb=self._37===1?deferred.onFulfilled:deferred.onRejected;if(cb===null){if(self._37===1){resolve(deferred.promise,self._12)}else{reject(deferred.promise,self._12)}return}var ret=tryCallOne(cb,self._12);if(ret===IS_ERROR){reject(deferred.promise,LAST_ERROR)}else{resolve(deferred.promise,ret)}})}function resolve(self,newValue){if(newValue===self){return reject(self,new TypeError("A promise cannot be resolved with itself."))}if(newValue&&(typeof newValue==="object"||typeof newValue==="function")){var then=getThen(newValue);if(then===IS_ERROR){return reject(self,LAST_ERROR)}if(then===self.then&&newValue instanceof Promise){self._37=3;self._12=newValue;finale(self);return}else if(typeof then==="function"){doResolve(then.bind(newValue),self);return}}self._37=1;self._12=newValue;finale(self)}function reject(self,newValue){self._37=2;self._12=newValue;finale(self)}function finale(self){for(var i=0;i<self._59.length;i++){handle(self,self._59[i])}self._59=null}function Handler(onFulfilled,onRejected,promise){this.onFulfilled=typeof onFulfilled==="function"?onFulfilled:null;this.onRejected=typeof onRejected==="function"?onRejected:null;this.promise=promise}function doResolve(fn,promise){var done=false;var res=tryCallTwo(fn,function(value){if(done)return;done=true;resolve(promise,value)},function(reason){if(done)return;done=true;reject(promise,reason)});if(!done&&res===IS_ERROR){done=true;reject(promise,LAST_ERROR)}}},{"asap/raw":132}],145:[function(require,module,exports){"use strict";var Promise=require("./core.js");module.exports=Promise;Promise.prototype.done=function(onFulfilled,onRejected){var self=arguments.length?this.then.apply(this,arguments):this;self.then(null,function(err){setTimeout(function(){throw err},0)})}},{"./core.js":144}],146:[function(require,module,exports){"use strict";var Promise=require("./core.js");module.exports=Promise;var TRUE=valuePromise(true);var FALSE=valuePromise(false);var NULL=valuePromise(null);var UNDEFINED=valuePromise(undefined);var ZERO=valuePromise(0);var EMPTYSTRING=valuePromise("");function valuePromise(value){var p=new Promise(Promise._99);p._37=1;p._12=value;return p}Promise.resolve=function(value){if(value instanceof Promise)return value;if(value===null)return NULL;if(value===undefined)return UNDEFINED;if(value===true)return TRUE;if(value===false)return FALSE;if(value===0)return ZERO;if(value==="")return EMPTYSTRING;if(typeof value==="object"||typeof value==="function"){try{var then=value.then;if(typeof then==="function"){return new Promise(then.bind(value))}}catch(ex){return new Promise(function(resolve,reject){reject(ex)})}}return valuePromise(value)};Promise.all=function(arr){var args=Array.prototype.slice.call(arr);return new Promise(function(resolve,reject){if(args.length===0)return resolve([]);var remaining=args.length;function res(i,val){if(val&&(typeof val==="object"||typeof val==="function")){if(val instanceof Promise&&val.then===Promise.prototype.then){while(val._37===3){val=val._12}if(val._37===1)return res(i,val._12);if(val._37===2)reject(val._12);val.then(function(val){res(i,val)},reject);return}else{var then=val.then;if(typeof then==="function"){var p=new Promise(then.bind(val));p.then(function(val){res(i,val)},reject);return}}}args[i]=val;if(--remaining===0){resolve(args)}}for(var i=0;i<args.length;i++){res(i,args[i])}})};Promise.reject=function(value){return new Promise(function(resolve,reject){reject(value)})};Promise.race=function(values){return new Promise(function(resolve,reject){values.forEach(function(value){Promise.resolve(value).then(resolve,reject)})})};Promise.prototype["catch"]=function(onRejected){return this.then(null,onRejected)}},{"./core.js":144}],147:[function(require,module,exports){"use strict";var Promise=require("./core.js");module.exports=Promise;Promise.prototype["finally"]=function(f){return this.then(function(value){return Promise.resolve(f()).then(function(){return value})},function(err){return Promise.resolve(f()).then(function(){throw err})})}},{"./core.js":144}],148:[function(require,module,exports){"use strict";module.exports=require("./core.js");require("./done.js");require("./finally.js");require("./es6-extensions.js");require("./node-extensions.js")},{"./core.js":144,"./done.js":145,"./es6-extensions.js":146,"./finally.js":147,"./node-extensions.js":149}],149:[function(require,module,exports){"use strict";var Promise=require("./core.js");var asap=require("asap");module.exports=Promise;Promise.denodeify=function(fn,argumentCount){argumentCount=argumentCount||Infinity;return function(){var self=this;var args=Array.prototype.slice.call(arguments,0,argumentCount>0?argumentCount:0);return new Promise(function(resolve,reject){args.push(function(err,res){if(err)reject(err);else resolve(res)});var res=fn.apply(self,args);if(res&&(typeof res==="object"||typeof res==="function")&&typeof res.then==="function"){resolve(res)}})}};Promise.nodeify=function(fn){return function(){var args=Array.prototype.slice.call(arguments);var callback=typeof args[args.length-1]==="function"?args.pop():null;var ctx=this;try{return fn.apply(this,arguments).nodeify(callback,ctx)}catch(ex){if(callback===null||typeof callback=="undefined"){return new Promise(function(resolve,reject){reject(ex)})}else{asap(function(){callback.call(ctx,ex)})}}}};Promise.prototype.nodeify=function(callback,ctx){if(typeof callback!="function")return this;this.then(function(value){asap(function(){callback.call(ctx,null,value)})},function(err){asap(function(){callback.call(ctx,err)})})}},{"./core.js":144,asap:131}]},{},[2])(2)});
